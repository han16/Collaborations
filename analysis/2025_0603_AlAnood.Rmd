---
title: "06/26 2025"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
date: "2025-06-26"
---


```{r, echo=F, message=F, warning=F, results=F}
library(rprojroot)
root <- rprojroot::find_rstudio_root_file()
source(file.path(root, "analysis/Rfunctions.R"))
root <- rprojroot::find_rstudio_root_file()
```



```{r, message=F, warning=F, results=F}
data_raw=multiplesheets((file.path(root, "..\\2025\\202506\\AlAnood\\2025 final data file AA Epiquik Data_061325.xlsx")))
data=data_raw$blue_table
```


## summary statistics 


### day 1

```{r, message=F, warning=F}
summary_statistics(data %>% filter(day=="1day"))%>%
datatable(extensions = 'Buttons',
          caption = "", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



### day 7

```{r, message=F, warning=F}
summary_statistics(data %>% filter(day=="7day"))%>%
datatable(extensions = 'Buttons',
          caption = "", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



## anova 



```{r, message=F, warning=F}
# Convert all Group columns to numeric (real NA will be preserved)
group_cols <- grep("^Group", names(data))
data[, group_cols] <- lapply(data[, group_cols], function(x) as.numeric(as.character(x)))

data_day1_long=tidyr::pivot_longer(
  data %>% filter(day=="1day"),
  cols = starts_with("Group"),
  names_to = "Group",
  values_to = "Value"
)
```



```{r, message=F, warning=F}
ggplot(data_day1_long, aes(x = Group, y = Value, fill = Group)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Day 1", y = "", x = "") +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1),
    legend.position = "none",                    # remove legend
    plot.title = element_text(hjust = 0.5)       # center title
  )
```





```{r, message=F, warning=F}

# Run one-way ANOVA
anova_result <- aov(Value ~ Group, data = data_day1_long)

# Show summary
summary(anova_result)
```



* large p value indicates failure of rejecting null hypothesis of 6 groups being equal. 



```{r, message=F, warning=F}

data_day7_long=tidyr::pivot_longer(
  data %>% filter(day=="7day"),
  cols = starts_with("Group"),
  names_to = "Group",
  values_to = "Value"
)


```


```{r, message=F, warning=F}
ggplot(data_day7_long, aes(x = Group, y = Value, fill = Group)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Day 7", y = "", x = "") +
  theme(
    axis.text.x = element_text(angle = 0, hjust = 1),
    legend.position = "none",                    # remove legend
    plot.title = element_text(hjust = 0.5)       # center title
  )
```



```{r, message=F, warning=F}


# Run one-way ANOVA
anova_result <- aov(Value ~ Group, data = data_day7_long)

# Show summary
summary(anova_result)
```

* small p value suggests at least one group is different from others. 



## pairwise comparions 

### day 1




```{r, message=F, warning=F}

day1_data=data %>% filter(day=="1day") %>% select(`Group 1`, `Group 2`, `Group 3`, `Group 4`, `Group 5`, `Group 6`)%>%
  mutate(across(everything(), ~as.numeric(.)))  # convert all to numeric

# Group names
group_names <- colnames(day1_data)

# Store results
results <- list()

# Pairwise t-tests with NA removal
for (i in 1:(ncol(day1_data) - 1)) {
  for (j in (i + 1):ncol(day1_data)) {
    group1 <- na.omit(day1_data[[i]])
    group2 <- na.omit(day1_data[[j]])
    
    # Check both groups have at least 2 non-NA values
    if (length(group1) >= 2 && length(group2) >= 2) {
      test <- t.test(group1, group2)
      p_value <- pvalue_adjust(test$p.value)
    } else {
      p_value <- NA
    }
    
    comparison <- paste(group_names[i], "vs", group_names[j])
    results[[length(results) + 1]] <- c(comparison, p_value)
  }
}

# Convert to matrix
result_matrix <- do.call(rbind, results)
colnames(result_matrix) <- c("Comparison", "P-value")

result_matrix %>%
datatable(extensions = 'Buttons',
          caption = "", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### day 7




```{r, message=F, warning=F}

day7_data=data %>% filter(day=="7day") %>% select(`Group 1`, `Group 2`, `Group 3`, `Group 4`, `Group 5`, `Group 6`)%>%
  mutate(across(everything(), ~as.numeric(.)))  # convert all to numeric

# Group names
group_names <- colnames(day7_data)

# Store results
results <- list()

# Pairwise t-tests with NA removal
for (i in 1:(ncol(day7_data) - 1)) {
  for (j in (i + 1):ncol(day7_data)) {
    group1 <- na.omit(day7_data[[i]])
    group2 <- na.omit(day7_data[[j]])
    
    # Check both groups have at least 2 non-NA values
    if (length(group1) >= 2 && length(group2) >= 2) {
      test <- t.test(group1, group2)
      p_value <- pvalue_adjust(test$p.value)
    } else {
      p_value <- NA
    }
    
    comparison <- paste(group_names[i], "vs", group_names[j])
    results[[length(results) + 1]] <- c(comparison, p_value)
  }
}

# Convert to matrix
result_matrix <- do.call(rbind, results)
colnames(result_matrix) <- c("Comparison", "P-value")

result_matrix %>%
datatable(extensions = 'Buttons',
          caption = "", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


* two sample t test was used. 



### day 1 vs day 7 

```{r, message=F, warning=F}
# Initialize an empty vector for p-values
p_values <- numeric(ncol(day1_data))

# Loop through each group (column) to compute paired t-test p-values
for (i in seq_along(day1_data)) {
  day1 <- day1_data[[i]]
  day7 <- day7_data[[i]]
  test <- t.test(day1, day7, paired = TRUE, na.action = na.omit)
  p_values[i] <- pvalue_adjust(test$p.value)
}

# Create a matrix with group names and p-values
p_value_matrix <- matrix(p_values, nrow = 1)
colnames(p_value_matrix) <- colnames(day1_data)
rownames(p_value_matrix) <- "p-value"

# Print the matrix
p_value_matrix%>%
datatable(extensions = 'Buttons',
          caption = "", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```
* paired two sample t test was used. 

