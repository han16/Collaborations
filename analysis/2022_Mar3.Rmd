---
title: "3/29/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr) # combine and arrange multiple 
library(rstatix) # use anova_test function 
set.seed(123)
```

```{r, echo=F, echo=F, message=F}
data=as_tibble(read.csv("C:\\Shengtong\\Research\\AllCollaboration\\2022\\202203\\Kate\\FullDataSAI.csv", header=T))
```


## response and potential predictors 

### PBI (papillary bleeding index)

#### trajectory plot 

* measurements are taken at 2 time points, `PBI.Screening`, `PBI.8.wk`, and are longitudinal data 

```{r, echo=F, message=F, warning=F}
data_long=data.frame(PBI=c(data$PBI.Screening, data$PBI.8.wk), time=rep(c("screening", "week 8"), each=nrow(data)), individual=rep(seq(1, nrow(data)),2))

g1=ggplot(data=data_long,aes(x=time, y=PBI, group=individual))+
  geom_line(color="red")+
  geom_point()


g2=ggplot(data.frame(PBI_mean=c(mean(data$PBI.Screening),mean(data$PBI.8.wk)), time=c("screening", "week 8")), aes(x=time, y=PBI_mean, group=1))+
  ylim(c(min(data$PBI.8.wk, data$PBI.Screening), max(data$PBI.8.wk, data$PBI.Screening)))+
  geom_line(color="red")+
  geom_point()

figure <- ggarrange(g1, g2,
                   # labels = c("A", "B", "C"),
                    ncol = 2, nrow = 1)
figure 
```


#### summary statistics 

```{r, echo=F, message=F, warning=F}
data_long %>%
  group_by(time) %>%
  get_summary_stats(PBI, type = "mean_sd")
```

#### boxplot 


```{r, echo=F, warning=F, message=F}
bxp <- ggboxplot(data_long, x = "time", y = "PBI", add = "point")
bxp
```

#### outlier detection 



```{r, echo=F, message=F, warning=F}
data_long %>% 
  group_by(time) %>% 
  identify_outliers(PBI)
```

#### normality assumption 

```{r, echo=F, message=F, warning=F}
data_long %>% group_by(time) %>% shapiro_test(PBI)
```

* all p values are bigger than 0.05, suggesting they are normally distributed. 

```{r, echo=F, message=F, warning=F}
ggqqplot(data_long, "PBI", facet.by="time")
```


* most points fall along reference line, normality assumption is reasonable. 





```{r, echo=F, message=F, warning=F}
res.aov <- anova_test(data = data_long, dv = PBI, wid = individual, within = time)

get_anova_table(res.aov)
```
 * [anova_test](https://search.r-project.org/CRAN/refmans/rstatix/html/anova_test.html) repeated measures ANOVA 
 
 * PBI: dependent variable 
 
 * PIB are statistical different between screening and week 8 by small p value of 0.032. 
 
 
 
```{r, echo=F, message=F, warning=F}
pwc=data_long %>% pairwise_t_test(PBI ~ time, paired=T, p.adjust.method = "bonferroni")
pwc=pwc %>%add_xy_position(x="time")

bxp+
  stat_pvalue_manual(pwc)+
  labs(subtitle=get_test_label(res.aov, detailed = T), caption=get_pwc_label(pwc))

```
 

## statistical software 

```{r, echo=F}
R.version
```

