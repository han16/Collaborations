---
title: "12/16/2022"
output: html_document
date: '2022-12-16'
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr) # combine and arrange multiple 
library(kableExtra)
library(rstatix) # use anova_test function 
library(DT)
set.seed(123)
```

```{r, echo=F, warning=F, message=F}
data=as_tibble(read.csv("C:\\Shengtong\\Research\\AllCollaboration\\2022\\202212\\Arndt\\Trueness_CompareStudies_2022_ALL DATA.csv", header=T))
# based on sleeveheight, split into 3 different balanced groups, low mediam, high, and then for each group, regress angle to sleeveheight and drillguidance   
```


## SleeveHeight


```{r, echo=F, message=F, warning=F}
  

p=ggplot(data.frame(var=rep("SleeveHeight", 140), SleeveHeight=data$SleeveHeight), aes(x=var, y=SleeveHeight))+
  geom_boxplot()
p+geom_dotplot(binaxis='y', stackdir='center', dotsize=0.6)+
  ggtitle("boxplot of SleeveHeight")+
  theme(plot.title = element_text(hjust = 0.5, size=15)) # center the title

quantile(data$SleeveHeight, probs=c(0, 0.33, 0.66,1))
```
### SleeveHeight<=3.5

* based on `SleeveHeight`, split into 3 groups (1) `SleeveHeight<=3.5`, 60 observations (2) `SleeveHeight>3.5 & SleeveHeight<=5`, 40 observations (3) `SleeveHeight>5`, 40 observations 


```{r, echo=F, message=F, warning=F}
sub_data=data%>%filter(SleeveHeight<=3.5)
reg=lm(Angle~SleeveHeight+DrillGuidance, sub_data)
SleeveHeight=sub_data%>%select(SleeveHeight) %>% pull()
DrillGuidance=sub_data%>% select(DrillGuidance) %>% pull()
#cor(SleeveHeight,DrillGuidance)
#summary(reg)
#confint(reg, 'SleeveHeight', level=0.95)

ggplot(sub_data, aes(x=SleeveHeight, y=Angle)) +   # add regression line 
  geom_point()+
  geom_smooth(method=lm)

```


* SleeveHeight=DrillGuidance, only one variable is effective 



### SleeveHeight>3.5 & SleeveHeight<=5

```{r, echo=F, message=F, warning=F}
sub_data=data%>%filter(SleeveHeight>3.5 & SleeveHeight<=5)
reg=lm(Angle~SleeveHeight+DrillGuidance, sub_data)
SleeveHeight=sub_data%>%select(SleeveHeight) %>% pull()
DrillGuidance=sub_data%>% select(DrillGuidance) %>% pull()
#cor(SleeveHeight,DrillGuidance)
#summary(reg)
#confint(reg, 'SleeveHeight', level=0.95)

ggplot(sub_data, aes(x=SleeveHeight, y=Angle)) +   # add regression line 
  geom_point()+
  geom_smooth(method=lm)
```

* correlation between SleeveHeight and DrillGuidance is 1. 

### SleeveHeight>5 

```{r, echo=F, message=F, warning=F}
sub_data=data%>%filter(SleeveHeight>5)
reg=lm(Angle~SleeveHeight+DrillGuidance, sub_data)
SleeveHeight=sub_data %>% select(SleeveHeight) %>% pull()
DrillGuidance=sub_data %>% select(DrillGuidance) %>% pull()
#cor(SleeveHeight,DrillGuidance)
#summary(reg)
#confint(reg, 'SleeveHeight', level=0.95)

ggplot(sub_data, aes(x=SleeveHeight, y=Angle)) +   # add regression line 
  geom_point()+
  geom_smooth(method=lm)
```




```{r, echo=F, message=F, warning=F}
group=rep(NA, nrow(data))
group[which(data$SleeveHeight<=3.5)]="SleeveHeight<=3.5"
group[which(data$SleeveHeight>3.5 & data$SleeveHeight<=5)]="SleeveHeight>3.5 & SleeveHeight<=5"
group[which(data$SleeveHeight>5)]="SleeveHeight>5"
data_with_group=data%>%mutate(group=group)
ggplot(data_with_group, aes(x=SleeveHeight, y=Angle, color=group, shape=group)) +
  geom_point() + 
  geom_smooth(method=lm)+
  theme(legend.position="bottom")
```

```{r, echo=F, message=F, warning=F}
parameter_estimate=c(-3.57, -1.03, 0.09)
confidence_low=c(-5.24, -1.72, -1.46)
confidence_upper=c(-1.90, -0.34, 1.65)
group=c("SleeveHeight<=3.5", "SleeveHeight>3.5 & SleeveHeight<=5","SleeveHeight>5")
pvalue=c("7.06e-05", "0.004240", "0.903")

data.frame(group=group, SleeveHeight_coefficient=parameter_estimate, CI_low=confidence_low, CI_upper=confidence_upper, pvalue=pvalue) %>% datatable(extensions = 'Buttons',
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


## statistical software 

```{r, echo=F}
R.version
```