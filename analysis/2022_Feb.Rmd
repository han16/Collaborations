---
title: "2022 Feb"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
```

## Probem 1  

```{r, echo=T, eval=F}
 perform a sample size calculation with an 80% power, on the basis of reported clinical and radiographical failure rates of pulpotomy treatment which ranges between 10%-20% (for each) in the literature. `
```



## Problem 2 

```{r, echo=T, eval=F}
Will it it be possible if we make estimatations of sample sizes for 10%, 12% and 15% differences (respectively) between the groups with significance level of 0.05? 
```


## Problem formulation 


### power vs sample size 

Because sample size is not big (<40), it's better to assume binomial distribution for number of success, $X$. Consider the hypothesis test, $H_0: p=p_0$ vs $H_a: p< p_0$. The power is defined as $P(reject~ H_0|H_a)=P(X<=X_0|p)=\sum_{X=0}^{X_0} {n \choose k}p^k(1-p)^{n-k}$, so power is a function of following three parameters 

* $p$ is success probability in alternative hypothesis 
* $n$  is sample size 
* $X_0$ is rejection cutoff such that X is rejected when $X<X_0$, at specified significance level  


```{r, echo=T}
n=seq(10, 40, by=2) # vary sample size from 10 to 40
p0=0.2
k=qbinom(0.05, n, p0)-1 # significance level 0.05; p_0=0.5 
pa=0.2 # pa is any value within H_a
power=pbinom(k, n, pa) # calculate power when p=pa
ggplot(data=data.frame(n, k, power), aes(x=n, y=power, group=1)) +
  geom_line(color="red")+
  geom_hline(yintercept=0.8, linetype="dashed", color = "blue")+
  geom_point()+
  ylim(c(0,1))+
  ggtitle("p=0.2")
  
n=seq(10, 40, by=2) # vary sample size from 10 to 40 
k=qbinom(0.05, n, p0)-1 # significance level 0.05; p_0=0.5 
pa=0.01 # pa is any value within H_a
power=pbinom(k, n, pa) # calculate power when p=pa
ggplot(data=data.frame(n, k, power), aes(x=n, y=power, group=1)) +
  geom_line(color="red")+
  geom_hline(yintercept=0.8, linetype="dashed", color = "blue")+
  geom_point()+
  ylim(c(0,1))+
  ggtitle("p=0.1")

```

### two sample proportion test 

In two independent samples, $p_1, p_2$ are sample proportions. Consider 
 the test $H_0:p_1-p_2=p_0$ vs $H_a:p_1-p_2<p_0$, $p_0$ is the specified difference. Use test statistics $$Z=\frac{\hat{p_1}-\hat{p_2}-p_0}{\sqrt{\hat{p}(1-\hat{p}(1/n_1+1/n_2))}}$$, 
 
 where $\hat{p_1}=\frac{No.X=1}{n_1}, \hat{p_2}=\frac{No.Y=1}{n_2}$ are estimated proportions in two samples, and $\hat{p}=\frac{No.X=1+No.Y=1}{n_1+n_2}$ in the combined sample. Under null hypothesis, $Z\sim N(0.1)$ approximately. The test needs to be rejected when $Z<Z_{\alpha}$, e.g. $Z_{0.05}=-1.64$. 
 

