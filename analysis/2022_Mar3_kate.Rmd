---
title: "3/29/2022"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr) # combine and arrange multiple 
library(rstatix) # use anova_test function 
set.seed(123)
```

```{r, echo=F, echo=F, message=F}
data=as_tibble(read.csv("C:\\Shengtong\\Research\\AllCollaboration\\2022\\202203\\Kate\\FullDataSAI.csv", header=T))
```



## PBI (papillary bleeding index)

### trajectory plot 

* measurements are taken at 2 time points, `PBI.Screening`, `PBI.8.wk`, and are longitudinal data 

```{r, echo=F, message=F, warning=F}
#data_long=data.frame(PBI=c(data$PBI.Screening, data$PBI.8.wk), time=rep(c("screening", "week 8"), each=nrow(data)), individual=rep(seq(1, nrow(data)),2))

data_long=data.frame(PBI=c(data$PBI.Screening, data$PBI.8.wk), time=rep(c("screening", "week 8"), each=nrow(data)), individual=rep(data$Patient.ID.Number,2))

g1=ggplot(data=data_long,aes(x=time, y=PBI, group=individual))+
  geom_line(color="red")+
  geom_point()


g2=ggplot(data.frame(PBI_mean=c(mean(data$PBI.Screening),mean(data$PBI.8.wk)), time=c("screening", "week 8")), aes(x=time, y=PBI_mean, group=1))+
  ylim(c(min(data$PBI.8.wk, data$PBI.Screening), max(data$PBI.8.wk, data$PBI.Screening)))+
  geom_line(color="red")+
  geom_point()

figure <- ggarrange(g1, g2,
                   # labels = c("A", "B", "C"),
                    ncol = 2, nrow = 1)
figure 
```


### summary statistics 

```{r, echo=F, message=F, warning=F}
data_long %>%
  group_by(time) %>%
  get_summary_stats(PBI, type = "mean_sd")
```

### boxplot 


```{r, echo=F, warning=F, message=F}
bxp <- ggboxplot(data_long, x = "time", y = "PBI", add = "point")
bxp
```

### outlier detection 



```{r, echo=F, message=F, warning=F}
data_long %>% 
  group_by(time) %>% 
  identify_outliers(PBI)
```

### normality assumption 

```{r, echo=F, message=F, warning=F}
data_long %>% group_by(time) %>% shapiro_test(PBI)
```

* all p values are bigger than 0.05, suggesting they are normally distributed. 

```{r, echo=F, message=F, warning=F}
ggqqplot(data_long, "PBI", facet.by="time")
```


* most points fall along reference line, normality assumption is reasonable. 





```{r, echo=F, message=F, warning=F}
res.aov <- anova_test(data = data_long, dv = PBI, wid = individual, within = time)

get_anova_table(res.aov)
```
 * [anova_test](https://search.r-project.org/CRAN/refmans/rstatix/html/anova_test.html) repeated measures ANOVA 
 
 * PBI: dependent variable 
 
 * PIB are statistical different between screening and week 8 by small p value of 0.032. 
 
 
 
```{r, echo=F, message=F, warning=F}
pwc=data_long %>% pairwise_t_test(PBI ~ time, paired=T, p.adjust.method = "bonferroni")
pwc=pwc %>%add_xy_position(x="time")

bxp+
  stat_pvalue_manual(pwc)+
  labs(subtitle=get_test_label(res.aov, detailed = T), caption=get_pwc_label(pwc))

```
 


## Cluster PBI by change direction 


```{r, echo=F, message=F, warning=F}
PBI_increase_indi=data%>%filter(Change.PBI_Screening.PBI.8.wk<0) %>% select(Patient.ID.Number) %>% pull
PBI_decrease_indi=data%>%filter(Change.PBI_Screening.PBI.8.wk>0) %>% select(Patient.ID.Number) %>% pull
data_long_increase=data_long%>%filter(individual %in% PBI_increase_indi==T)
data_long_decrease=data_long%>%filter(individual %in% PBI_decrease_indi==T)

```



```{r, echo=F, message=F, warning=F}
g1=ggplot(data=data_long_increase,aes(x=time, y=PBI, group=individual))+
  geom_line(color="red")+
  geom_point()


g2=ggplot(data.frame(PBI_mean=c(mean(data[data$Patient.ID.Number%in% PBI_increase_indi, ]$PBI.Screening),mean(data[data$Patient.ID.Number%in% PBI_increase_indi,]$PBI.8.wk)), time=c("screening", "week 8")), aes(x=time, y=PBI_mean, group=1))+
  ylim(c(min(data$PBI.8.wk, data$PBI.Screening), max(data$PBI.8.wk, data$PBI.Screening)))+
  geom_line(color="red")+
  geom_point()

figure <- ggarrange(g1, g2,
                   # labels = c("A", "B", "C"),
                    ncol = 2, nrow = 1)
figure
############################
data_long_increase %>%
  group_by(time) %>%
  get_summary_stats(PBI, type = "mean_sd")
###########################
res.aov <- anova_test(data = data_long_increase, dv = PBI, wid = individual, within = time)

get_anova_table(res.aov)
```

```{r, echo=F, message=F, warning=F}
g1=ggplot(data=data_long_decrease,aes(x=time, y=PBI, group=individual))+
  geom_line(color="red")+
  geom_point()


g2=ggplot(data.frame(PBI_mean=c(mean(data[data$Patient.ID.Number%in% PBI_decrease_indi, ]$PBI.Screening),mean(data[data$Patient.ID.Number%in% PBI_decrease_indi,]$PBI.8.wk)), time=c("screening", "week 8")), aes(x=time, y=PBI_mean, group=1))+
  ylim(c(min(data$PBI.8.wk, data$PBI.Screening), max(data$PBI.8.wk, data$PBI.Screening)))+
  geom_line(color="red")+
  geom_point()

figure <- ggarrange(g1, g2,
                   # labels = c("A", "B", "C"),
                    ncol = 2, nrow = 1)
figure
############################
data_long_decrease %>%
  group_by(time) %>%
  get_summary_stats(PBI, type = "mean_sd")
###########################
res.aov <- anova_test(data = data_long_decrease, dv = PBI, wid = individual, within = time)

get_anova_table(res.aov)
```


## SAI (sleep apnea index) & PBI - two way repeated anova 


Each individual has one single SAI for both before and after the screening. 


```{r, echo=F, warning=F, message=F}
sai_group1=data%>%filter(SAI<5)  # split sample into 3 groups by SAI 
sai_group2=data%>%filter(SAI>=5 & SAI<=15)
sai_group3=data%>%filter(SAI>15)
                         
data_long_sai_group1=data.frame(PBI=c(sai_group1$PBI.Screening, sai_group1$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(sai_group1)), individual=rep(sai_group1$Patient.ID.Number,2), group=rep("SAI<5", 2*nrow(sai_group1)))
data_long_sai_group2=data.frame(PBI=c(sai_group2$PBI.Screening, sai_group2$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(sai_group2)), individual=rep(sai_group2$Patient.ID.Number,2), group=rep("SAI>=5, SAI<=15", 2*nrow(sai_group2)))
data_long_sai_group3=data.frame(PBI=c(sai_group3$PBI.Screening, sai_group3$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(sai_group3)), individual=rep(sai_group3$Patient.ID.Number,2), group=rep("SAI>15", 2*nrow(sai_group3)))

data_long_sai=rbind(data_long_sai_group1, data_long_sai_group2, data_long_sai_group3)   # combine sub-groups together 


```



```{r, echo=F, message=F, warning=F}
data_long_sai %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

bxp=ggboxplot(data_long_sai, x="time", y="PBI", color="group", palette="jco", main="all sample")
bxp

res.aov = anova_test(
  data = data_long_sai, 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```

```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_sai %>% filter(individual %in% PBI_increase_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_sai %>% filter(individual %in% PBI_increase_indi), x="time", y="PBI", color="group", palette="jco", main="PBI increase subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_sai %>% filter(individual %in% PBI_increase_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_sai %>% filter(individual %in% PBI_decrease_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_sai %>% filter(individual %in% PBI_decrease_indi), x="time", y="PBI", color="group", palette="jco", main="PBI decrease subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_sai %>% filter(individual %in% PBI_decrease_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```




```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_sai_screeing=data_long_sai %>% filter(time=="screening")
res.aov <- aov(PBI ~ group, data = data_long_sai_screeing)
# Summary of the analysis
summary(res.aov)
```
* no PBI difference among 3 groups at screening 


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_sai_week8=data_long_sai %>% filter(time=="week 8")
res.aov <- aov(PBI ~ group, data = data_long_sai_week8)
# Summary of the analysis
summary(res.aov)
```

* no difference among 3 groups at week 8 


```{r, echo=F, message=F, warning=F}
#data_long_sai %>% pairwise_t_test(PBI~group, paired = T, p.adjust.method = "bonferroni")
data_long_sai %>% pairwise_t_test(PBI~time, paired = T, p.adjust.method = "bonferroni") # comparison for time variables 
```

* there is difference between screening and week 8. 








## sRDI & PBI 



```{r, echo=F, message=F, warning=F}
miss_var="sRDI"; 
miss_var_prop=sum(is.na(data$sRDI)==T)/nrow(data)
ggplot(data.frame(variables=miss_var, missing_prop=miss_var_prop), aes(x=miss_var, y=miss_var_prop, fill=variables)) +geom_bar(stat="identity")+
  ylim(c(0, 1.2))+
  ylab("missing value (%)")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle =0, vjust = 0.5, size=10))+
  geom_text(aes(label=round(miss_var_prop,2)*100), position=position_dodge(width=0.9), vjust=-0.25)+  # add numbers over bars
 # ggtitle("Variables with missing values and their proportions")+
  theme(plot.title = element_text(hjust = 0.5, size=15))  #center the title 
```



```{r, echo=F, warning=F, message=F}
srdi_group1=data%>%drop_na(sRDI)%>%filter(sRDI<5)  # split sample into 3 groups; remove subjects with NA sRDI 
srdi_group2=data%>%drop_na(sRDI)%>%filter(sRDI>=5 & sRDI<=15)
srdi_group3=data%>%drop_na(sRDI)%>%filter(sRDI>15)
                         
data_long_srdi_group1=data.frame(PBI=c(srdi_group1$PBI.Screening, srdi_group1$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(srdi_group1)), individual=rep(srdi_group1$Patient.ID.Number,2), group=rep("sRDI<5", 2*nrow(srdi_group1)))

data_long_srdi_group2=data.frame(PBI=c(srdi_group2$PBI.Screening, srdi_group2$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(srdi_group2)), individual=rep(srdi_group2$Patient.ID.Number,2), group=rep("sRDI>=5, sRDI<=15", 2*nrow(srdi_group2)))

data_long_srdi_group3=data.frame(PBI=c(srdi_group3$PBI.Screening, srdi_group3$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(srdi_group3)), individual=rep(srdi_group3$Patient.ID.Number,2), group=rep("sRDI>15", 2*nrow(srdi_group3)))

data_long_srdi=rbind(data_long_srdi_group1, data_long_srdi_group2, data_long_srdi_group3)   # combine sub-groups together 


```





```{r, echo=F, message=F, warning=F}
data_long_srdi %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

bxp=ggboxplot(data_long_srdi, x="time", y="PBI", color="group", palette="jco", main="all sample")
bxp

res.aov = anova_test(
  data = data_long_srdi, 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_srdi %>% filter(individual %in% PBI_increase_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_srdi %>% filter(individual %in% PBI_increase_indi), x="time", y="PBI", color="group", palette="jco", main="PBI increase subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_srdi %>% filter(individual %in% PBI_increase_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```



```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_srdi %>% filter(individual %in% PBI_decrease_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_srdi %>% filter(individual %in% PBI_decrease_indi), x="time", y="PBI", color="group", palette="jco", main="PBI decrease subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_srdi %>% filter(individual %in% PBI_decrease_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


## SQI (sleep quality index) vs PBI 


Each individual has one SQI  for both before and after the screening. 


```{r, echo=F, warning=F, message=F}
sqi_group1=data%>%filter(SQI>55)  # split sample into 2 groups by SQI 
sqi_group2=data%>%filter(SQI<=55)
                         
data_long_sqi_group1=data.frame(PBI=c(sqi_group1$PBI.Screening, sqi_group1$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(sqi_group1)), individual=rep(sqi_group1$Patient.ID.Number,2), group=rep("SQI>55", 2*nrow(sqi_group1)))
data_long_sqi_group2=data.frame(PBI=c(sqi_group2$PBI.Screening, sqi_group2$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(sqi_group2)), individual=rep(sqi_group2$Patient.ID.Number,2), group=rep("SQI<=55", 2*nrow(sqi_group2)))

data_long_sqi=rbind(data_long_sqi_group1, data_long_sqi_group2)   # combine sub-groups together 

```



```{r, echo=F, message=F, warning=F}
data_long_sqi %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd") 
  
bxp=ggboxplot(data_long_sqi, x="time", y="PBI", color="group", palette="jco")
bxp


res.aov = anova_test(
  data = data_long_sqi, 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```

* big p values (>0.05) indicate no main or interaction effects 


```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_sqi %>% filter(individual %in% PBI_increase_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_sqi %>% filter(individual %in% PBI_increase_indi), x="time", y="PBI", color="group", palette="jco", main="PBI increase subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_sqi %>% filter(individual %in% PBI_increase_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_sqi %>% filter(individual %in% PBI_decrease_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_sqi %>% filter(individual %in% PBI_decrease_indi), x="time", y="PBI", color="group", palette="jco", main="PBI decrease subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_sqi %>% filter(individual %in% PBI_decrease_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_sqi_screeing=data_long_sqi %>% filter(time=="screening")
res.aov <- aov(PBI ~ group, data = data_long_sqi_screeing)
# Summary of the analysis
summary(res.aov)
```
* no PBI difference among 2 groups at screening 


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_sqi_week8=data_long_sqi %>% filter(time=="week 8")
res.aov <- aov(PBI ~ group, data = data_long_sqi_week8)
# Summary of the analysis
summary(res.aov)
```

* there is difference between two groups at week 8 

## Fragmentation vs PBI 


```{r, echo=F, warning=F, message=F}
fragmentation_group1=data%>%filter(Fragmentation<5)  # split sample into 3 groups by SAI 
fragmentation_group2=data%>%filter(Fragmentation>=5 & Fragmentation<=15)
fragmentation_group3=data%>%filter(Fragmentation>15)
                         
data_long_fragmentation_group1=data.frame(PBI=c(fragmentation_group1$PBI.Screening, fragmentation_group1$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(fragmentation_group1)), individual=rep(fragmentation_group1$Patient.ID.Number,2), group=rep("fragmentation<5", 2*nrow(fragmentation_group1)))
data_long_fragmentation_group2=data.frame(PBI=c(fragmentation_group2$PBI.Screening, fragmentation_group2$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(fragmentation_group2)), individual=rep(fragmentation_group2$Patient.ID.Number,2), group=rep("fragmentation>=5, fragmentation<=15", 2*nrow(fragmentation_group2)))
data_long_fragmentation_group3=data.frame(PBI=c(fragmentation_group3$PBI.Screening, fragmentation_group3$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(fragmentation_group3)), individual=rep(fragmentation_group3$Patient.ID.Number,2), group=rep("fragmentation>15", 2*nrow(fragmentation_group3)))

data_long_fragmentation=rbind(data_long_fragmentation_group1, data_long_fragmentation_group2, data_long_fragmentation_group3)   # combine sub-groups together 


```




```{r, echo=F, message=F, warning=F}
data_long_fragmentation%>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

bxp=ggboxplot(data_long_fragmentation, x="time", y="PBI", color="group", palette="jco")
bxp

res.aov = anova_test(
  data = data_long_fragmentation, 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```

 


* big p values (>0.05) indicate no main or interaction effects 



```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_fragmentation %>% filter(individual %in% PBI_increase_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_fragmentation %>% filter(individual %in% PBI_increase_indi), x="time", y="PBI", color="group", palette="jco", main="PBI increase subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_fragmentation %>% filter(individual %in% PBI_increase_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```


```{r, echo=F, message=F, warning=F}
# summary statistics 
data_long_fragmentation %>% filter(individual %in% PBI_decrease_indi) %>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")

# boxplot of each group 
bxp=ggboxplot(data_long_fragmentation %>% filter(individual %in% PBI_decrease_indi), x="time", y="PBI", color="group", palette="jco", main="PBI decrease subgroup")
bxp

# group by time interaction test 
res.aov = anova_test(
  data = data_long_fragmentation %>% filter(individual %in% PBI_decrease_indi), 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```

```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_fragmentation_screeing=data_long_fragmentation %>% filter(time=="screening")
res.aov <- aov(PBI ~ group, data = data_long_fragmentation_screeing)
# Summary of the analysis
summary(res.aov)
```
* no PBI difference among  groups at screening 


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_fragmentation_week8=data_long_fragmentation %>% filter(time=="week 8")
res.aov <- aov(PBI ~ group, data = data_long_fragmentation_week8)
# Summary of the analysis
summary(res.aov)
```
* no difference among groups at week 8. 


## BMI vs PBI 


```{r, echo=F, warning=F, message=F}
bmi_group1=data%>%filter(BMI.kg.m2<18.5)  # split sample into subgroups
bmi_group2=data%>%filter(BMI.kg.m2>=18.5 & BMI.kg.m2<24.9)
bmi_group3=data%>%filter(BMI.kg.m2>=24.9  & BMI.kg.m2<29.9)
bmi_group4=data%>%filter(BMI.kg.m2>=29.9  & BMI.kg.m2<34.9)
bmi_group5=data%>%filter(BMI.kg.m2>=34.9)
                         
data_long_bmi_group1=data.frame(PBI=c(bmi_group1$PBI.Screening,bmi_group1$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(bmi_group1)), individual=rep(bmi_group1$Patient.ID.Number,2), group=rep("(1):BMI<18.5", 2*nrow(bmi_group1)))

data_long_bmi_group2=data.frame(PBI=c(bmi_group2$PBI.Screening,bmi_group2$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(bmi_group2)), individual=rep(bmi_group2$Patient.ID.Number,2), group=rep("(2):18.5<=BMI<24.9", 2*nrow(bmi_group2)))

data_long_bmi_group3=data.frame(PBI=c(bmi_group3$PBI.Screening,bmi_group3$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(bmi_group3)), individual=rep(bmi_group3$Patient.ID.Number,2), group=rep("(3):24.9<=BMI<29.9", 2*nrow(bmi_group3)))

data_long_bmi_group4=data.frame(PBI=c(bmi_group4$PBI.Screening,bmi_group4$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(bmi_group4)), individual=rep(bmi_group4$Patient.ID.Number,2), group=rep("(4)29.9<=BMI<34.9", 2*nrow(bmi_group4)))

data_long_bmi_group5=data.frame(PBI=c(bmi_group5$PBI.Screening,bmi_group5$PBI.8.wk),  time=rep(c("screening", "week 8"), each=nrow(bmi_group5)), individual=rep(bmi_group5$Patient.ID.Number,2), group=rep("(5):BMI>=34.9", 2*nrow(bmi_group5)))

data_long_bmi=rbind(data_long_bmi_group1, data_long_bmi_group2, data_long_bmi_group3, data_long_bmi_group4, data_long_bmi_group5)   # combine sub-groups together 


```


### summary statistics 

```{r, echo=F, message=F, warning=F}
data_long_bmi%>% group_by(group, time) %>% get_summary_stats(PBI, type="mean_sd")
```

```{r, echo=F, message=F, warning=F}
bxp=ggboxplot(data_long_bmi, x="time", y="PBI", color="group", palette="jco")
bxp
```


### outliers 

```{r, echo=F, message=F, warning=F}
data_long_bmi %>% group_by(group, time) %>% identify_outliers(PBI)
```
one outlier 

### normality assumption 

```{r, echo=F, warning=F, message=F, eval=F}
data_long_bmi %>% group_by(group, time) %>% shapiro_test(PBI)
```



```{r, echo=F, message=F, warning=F}
ggqqplot(data_long_bmi, "PBI", ggtheme=theme_bw())+
  facet_grid(time ~ group, labeller="label_both")
```



### results 

```{r, echo=F, warning=F, message=F, eval=T}
#data_long_sai_two=data_long_sai%>% filter(group!="SAI>15")
#res.aov=anova_test(data=data_long_sai_two, dv=PBI, wid=individual, within=c(time, group))
#get_anova_table(res.aov)

res.aov = anova_test(
  data = data_long_bmi, 
  PBI ~ group * time,
  wid = individual
)
get_anova_table(res.aov)

```

* big p values (>0.05) indicate no main or interaction effects 


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_bmi_screeing=data_long_bmi %>% filter(time=="screening")
res.aov <- aov(PBI ~ group, data = data_long_bmi_screeing)
# Summary of the analysis
summary(res.aov)
```
* no PBI difference among  groups at screening 


```{r, echo=F, message=F, warning=F}
# anova test at every time point 
data_long_bmi_week8=data_long_bmi %>% filter(time=="week 8")
res.aov <- aov(PBI ~ group, data = data_long_bmi_week8)
# Summary of the analysis
summary(res.aov)
```
* no difference 


## statistical software 

```{r, echo=F}
R.version
```

