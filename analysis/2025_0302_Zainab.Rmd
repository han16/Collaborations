---
title: "03/05 2025"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
date: "2025-03-05"
---




```{r, echo=F, message=F, warning=F, results=F}
library(rprojroot)
root <- rprojroot::find_rstudio_root_file()
source(file.path(root, "analysis/Rfunctions.R"))
root <- rprojroot::find_rstudio_root_file()
```


```{r, message=F, warning=F, results=F}
MBSE_23=multiplesheets_without_headers((file.path(root, "../2025/202503/Zainab/23 Tablet grades seperated by exam 20250509.xlsx")))
MBSE_24=multiplesheets_without_headers((file.path(root, "..\\2025\\202503\\Zainab\\OT Research - 24 MBSE.xlsx")))
```

`
Probe only
23 Probe has 28 questions in one line

24 Probe has 4 lines per person 

Columns C - I
1st row for each person is 1 - 7
2nd row per person is 8 - 14
3rd row per person is 15 - 21
4th row per person is 22 - 28

Explorer, sickle, universal, area specific is set up as the 24 probe with 4 lines per person 
Cumulative was not evaluated the same and should not be considered in the analysis
`



## probe 

```{r, message=F, warning=F}
data_23=MBSE_23$`23 Probe`
data_24=MBSE_24$`24 Probe`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
sum(num_rows==4)==length(num_rows)  # ensure all students have 4 rows 
```


```{r, message=F, warning=F}
data_23_clean=data_23[,5:32]

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("probe", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


* two sample t test was used



## Explorer 

```{r, message=F, warning=F}
data_23=MBSE_23$`23 Explorer`
data_24=MBSE_24$`24 Explorer`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else which(num_rows != 4)

student_names_23=unique(data_23$...1)
num_rows=sapply(student_names_23, function(x) (data_23 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names_23[which(num_rows != 4)] # ensure all students have 4 rows 
  
```


```{r, message=F, warning=F, eval=F}
student_names_23=unique(data_23$...1)
data_23_clean=data_23 %>%
  filter(`...1` %in% student_names_23) %>%
  arrange(factor(`...1`, levels = student_names_23)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names_23), byrow = TRUE)  

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

ncol(data_23_clean)==ncol(data_24_clean)
pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("Explorer", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


## Sickle 

```{r, message=F, warning=F}
data_23=MBSE_23$`23 Sickle`
data_24=MBSE_24$`24 Sickle`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names[which(num_rows != 4)] # ensure all students have 4 rows

student_names_23=unique(data_23$...1)
num_rows=sapply(student_names_23, function(x) (data_23 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names_23[which(num_rows != 4)] # ensure all students have 4 rows 
  
```


```{r, message=F, warning=F}
data_23_clean=data_23 %>%
  filter(`...1` %in% student_names_23) %>%
  arrange(factor(`...1`, levels = student_names_23)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names_23), byrow = TRUE) 

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("Sickle", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


## Universal 

```{r, message=F, warning=F}
data_23=MBSE_23$`23 Universal`
data_24=MBSE_24$`24 Universal`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names[which(num_rows != 4)] # ensure all students have 4 rows

student_names_23=unique(data_23$...1)
num_rows=sapply(student_names_23, function(x) (data_23 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names_23[which(num_rows != 4)] # ensure all students have 4 rows 
   
```


```{r, message=F, warning=F, eval=T}

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

data_23_clean <- data_23 %>%
  filter(`...1` %in% student_names_23) %>%
  arrange(factor(`...1`, levels = student_names_23)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names_23), byrow = TRUE)  

ncol(data_23_clean)==ncol(data_24_clean)

pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("Universal", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



## Area Specific 

```{r, message=F, warning=F}
data_23=MBSE_23$`23 Area Specific`
data_24=MBSE_24$`24 Area Specific`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names[which(num_rows != 4)] # ensure all students have 4 rows

student_names_23=unique(data_23$...1)
num_rows=sapply(student_names_23, function(x) (data_23 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 4)) print("Correct") else student_names_23[which(num_rows != 4)] # ensure all students have 4 rows 
  
```


```{r, message=F, warning=F, eval=T}

data_23_clean <- data_23 %>%
  filter(`...1` %in% student_names_23) %>%
  arrange(factor(`...1`, levels = student_names_23)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names_23), byrow = TRUE) 

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("Area Specific", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



## Cumulative


```{r, message=F, warning=F}
data_23=MBSE_23$`23 Cumulative`
data_24=MBSE_24$`24 Cumulative`
```




```{r, message=F, warning=F}
# check if each student has the same 4 lines 
student_names=unique(data_24$...1)
num_rows=sapply(student_names, function(x) (data_24 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 5)) print("Correct") else student_names[which(num_rows != 5)] # ensure all students have 4 rows

student_names_23=unique(data_23$...1)
num_rows=sapply(student_names_23, function(x) (data_23 %>% filter(`...1`==x) %>% nrow()))
if (all(num_rows == 5)) print("Correct") else student_names_23[which(num_rows != 5)] # ensure all students have 4 rows 
  
```


```{r, message=F, warning=F, eval=F}

data_24_clean <- data_24 %>%
  filter(`...1` %in% student_names) %>%
  arrange(factor(`...1`, levels = student_names)) %>%
  select(3:9) %>%
  as.matrix() %>%
  t() %>%
  as.vector() %>%
  matrix(nrow = length(student_names), byrow = TRUE)  

pvalue=numeric()
for (i in 1:ncol(data_23_clean))
{
  if (sum(!is.na(data_23_clean[, i])) > 1 && sum(!is.na(data_24_clean[, i])) > 1) {
  pvalue[i]=t.test(data_23_clean[, i], data_24_clean[, i])$p.value
} else {
  pvalue[i]="NA"
}
  
}
  data.frame(questions=paste("Area Specific", seq(1:ncol(data_23_clean)), sep="_"), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```
