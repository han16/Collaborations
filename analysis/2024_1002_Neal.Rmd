---
title: "2024/10/07"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
date: "2024-10-07"
---



```{r, echo=F, message=F, warning=F, results=F}
library(rprojroot)
root <- rprojroot::find_rstudio_root_file()
source(file.path(root, "analysis/Rfunctions.R"))
root <- rprojroot::find_rstudio_root_file()
```


```{r, message=F, warning=F, results=F}
#data_raw=multiplesheets("C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\CBCT Thesis data FINAL VK011525.xlsx")
finalized_data=as_tibble(read.csv(file.path(root,"..\\2024\\202410\\Neal\\CBCT Thesis data FINAL VK011525_Finalized_Data.csv")))

#finalized_with_omitted_data=data_raw$`Finalized with Omitted data`
#coding=data_raw$`Coding`
#save(finalized_with_omitted_data, finalized_data, coding, file="C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\data.RData")
#load("C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\data.RData")


#colnames(finalized_data)
```




```{r, message=F, warning=F}
upper_posterior=c(2, 3, 4, 5, 12, 13, 14, 15)
upper_anterior=6:11
lower_posterior=c(18, 19, 20, 21, 28, 29, 30, 31)
lower_anterior=22:27
```





## 1 Finalized data 


```{r, message=F, warning=F}

colnames(finalized_data)
```




### 1.1 continuous variables 

```{r, message=F, warning=F, eval=T}
continuous_var=c("Age", 
"Months_btwn_CBCTS",  
"Months_btwn_Ext_CBCT.1",
"mesial_tooth_bone_loss_CBCT.2__mm",   
"mesial_tooth_bone_loss_DIFF", 
"mesial_tooth_bone_loss_CBCT.1__mm",
"distal_tooth_bone_loss_CBCT.1__mm",    
"distal_tooth_bone_loss_CBCT.2__mm",   
"distal_tooth_bone_loss_DIFF",    
"ANPNS_Crest_Coronal_CBCT1",
"ANSPNS_Crest_Coronal_CBCT2",          
"ANSPNS_Crest_Coronal_DIFF",           
"ANSPNS_Crest_Sagittal_CBCT1",        
"ANSPNS_Crest_Sagittal_CBCT2",         
"ANSPNS_Crest_Sagittal_DIFF",          
"ANSPNS_Sinus_Floor_Coronal_CBCT1",   
"ANSPNS_Sinus_Floor_Coronal_CBCT2",    
"ANSPNS_Sinus_Floor_Coronal_DIFF",     
"ANSPNS_Sinus_Floor_Sagittal_CBCT1",   
"ANSPNS_Sinus_Floor_Sagittal_CBCT2",   
"ANSPNS_Sinus_Floor_Sagittal_DIFF",    
"MENTAL_Crest_Coronal_CBCT1",         
"MENTAL_Crest_Coronal_CBCT2",         
 "MENTAL_Crest_Coronal_DIFF",           
"MENTAL_Crest_Sagittal_CBCT1",         
"MENTAL_Crest_Sagittal_CBCT2",         
"MENTAL_Crest_Sagittal_DIFF",
"Width_3mm_CBCT1",                     
"Width_3mm_CBCT2",                     
"Width_3mm_DIFF",                      
"Width_5mm_CBCT1",                     
"Width_5mm_CBCT2",                     
"Width_5mm_DIFF")
data_conti=data.frame(as.matrix(finalized_data[,which(colnames(finalized_data)%in%continuous_var)]))


###################### definitions
#Height_coronal_CBCT1 = ANS_PNS_crest_coronal_CBCT1 + mental_crest_coronal_CBCT1
#Height_coronal_CBCT2 = ANS_PNS_crest_coronal_CBCT2 + mental_crest_coronal_CBCT2
#Height_sagittal_CBCT1 = ANS_PNS_crest_sagittal_CBCT1 + mental_crest_sagittal_CBCT1
#Height_sagittal_CBCT2 = ANS_PNS_crest_sagittal_CBCT2 + mental_crest_sagittal_CBCT2


data_conti$Height_coronal_CBCT1=
  ifelse(is.na(data_conti$ANPNS_Crest_Coronal_CBCT1), 0, data_conti$ANPNS_Crest_Coronal_CBCT1) +
  ifelse(is.na(data_conti$MENTAL_Crest_Coronal_CBCT1), 0, data_conti$MENTAL_Crest_Coronal_CBCT1)
##############

data_conti$Height_coronal_CBCT2 <- 
  ifelse(is.na(data_conti$ANSPNS_Crest_Coronal_CBCT2), 0, data_conti$ANSPNS_Crest_Coronal_CBCT2) + 
  ifelse(is.na(data_conti$MENTAL_Crest_Coronal_CBCT2), 0, data_conti$MENTAL_Crest_Coronal_CBCT2)
##############

data_conti$Height_sagittal_CBCT1 <- 
  ifelse(is.na(data_conti$ANSPNS_Crest_Sagittal_CBCT1), 0, data_conti$ANSPNS_Crest_Sagittal_CBCT1) +  
  ifelse(is.na(data_conti$MENTAL_Crest_Sagittal_CBCT1), 0, data_conti$MENTAL_Crest_Sagittal_CBCT1)
  
##############

data_conti$Height_sagittal_CBCT2 <- 
  ifelse(is.na(data_conti$ANSPNS_Crest_Sagittal_CBCT2), 0, data_conti$ANSPNS_Crest_Sagittal_CBCT2) +
  ifelse(is.na(data_conti$MENTAL_Crest_Sagittal_CBCT2), 0, data_conti$MENTAL_Crest_Sagittal_CBCT2) 


##############

data_conti$Height_coronal_DIFF <- 
  ifelse(is.na(data_conti$ANSPNS_Crest_Coronal_DIFF), 0, data_conti$ANSPNS_Crest_Coronal_DIFF) +  
  ifelse(is.na(data_conti$MENTAL_Crest_Coronal_DIFF), 0, data_conti$MENTAL_Crest_Coronal_DIFF)
##############

data_conti$Height_sagittal_DIFF <- 
  ifelse(is.na(data_conti$ANSPNS_Crest_Sagittal_DIFF), 0, data_conti$ANSPNS_Crest_Sagittal_DIFF) +
  ifelse(is.na(data_conti$MENTAL_Crest_Sagittal_DIFF), 0, data_conti$MENTAL_Crest_Sagittal_DIFF)
#################


continuous_var=c(continuous_var,"Height_sagittal_CBCT1", "Height_sagittal_CBCT2", "Height_sagittal_DIFF",  "Height_coronal_DIFF", "Height_coronal_CBCT1", "Height_coronal_CBCT2" )

finalized_data$Height_coronal_CBCT1=data_conti$Height_coronal_CBCT1
finalized_data$Height_coronal_CBCT2=data_conti$Height_coronal_CBCT2
finalized_data$Height_sagittal_CBCT1=data_conti$Height_sagittal_CBCT1
finalized_data$Height_sagittal_CBCT2=data_conti$Height_sagittal_CBCT2
finalized_data$Height_coronal_DIFF=data_conti$Height_coronal_DIFF
finalized_data$Height_sagittal_DIFF=data_conti$Height_sagittal_DIFF

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```

```{r, message=F, warning=F}
## release these 4 variables 

data_conti %>% select(ANSPNS_Crest_Coronal_CBCT2, MENTAL_Crest_Coronal_CBCT2, Height_coronal_DIFF, ANPNS_Crest_Coronal_CBCT1, MENTAL_Crest_Coronal_CBCT1)%>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```




```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="pearson", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```





```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="spearman", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "Spearman correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```




### 1.2 discrete variables 


```{r, message=F, warning=F}
discrete_var=c("Tooth_site_number", 
               "Tooth_migration", 
               "M_Tooth_Migration",  
               "D_Tooth_Migration",  
               "Migration_Notes", 
               "mesial_tooth_bone_loss_CBCT.1__mm", 
               "Jaw",                        
                "Arch_Fully_edentulous_both_CBCTs",
                "Partially_edentulous",
               "Partial_Edentulous_Space_.Length",
                "Adjacent_teeth_number",
               "Adjacent_Note",                      
                "Restoration_type",
               "Restoration_Notes",                  
                "Ext_Reason",                                   
                "Coronal_sinus_floor_shift",  
                "Sinus_Pathology",
                 "Sites_10mm_height_or_more",          
                 "X1st_CBCT_10mm_or_more",
               "X2nd_CBCT_10mm_or_more", 
               "Sites_10mm_height_or_more")
data_discrete=finalized_data[,which(colnames(finalized_data)%in%discrete_var)]

res=apply(data_discrete, 2, discrete_summary)
```





```{r, message=F, warning=F, results='asis'}
# Create a tagList to collect all datatables
library(htmltools)
output_list <- tagList()
for (k in 1:length(res))
  
{

  res_df <- data.frame(res[[k]]) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0
  for (i in 1:(nrow(res[[k]])-1))
  for (j in (i+1):nrow(res[[k]]))
  {
    kk=kk+1
    parameters[kk]=paste(res[[k]][i,1], res[[k]][j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res[[k]][i,2], res[[k]][j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)


  
  
  
}

# Render all datatables
output_list
```




```{r, message=F, warning=F}

sub_data=finalized_data %>% select(Patient, Gender, Smoking)

unique_patients <- sub_data %>%
  group_by(Patient) %>%
  filter(Gender != "") %>%  # Remove empty Gender rows
  slice(1) %>%  # Keep the first occurrence per Patient
  ungroup()

res=apply(unique_patients[,2:3], 2, discrete_summary)



# Create a tagList to collect all datatables
library(htmltools)
output_list <- tagList()
for (k in 1:length(res))
  
{

  res_df <- data.frame(res[[k]]) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = names(res)[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0
  for (i in 1:(nrow(res[[k]])-1))
  for (j in (i+1):nrow(res[[k]]))
  {
    kk=kk+1
    parameters[kk]=paste(res[[k]][i,1], res[[k]][j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res[[k]][i,2], res[[k]][j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = names(res)[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)


  
  
  
}

# Render all datatables
output_list

```






### 1.3 tooth site groups 

```{r, message=F, warning=F}
n=c(finalized_data %>% filter(Tooth_site_number %in% upper_posterior) %>% nrow(), 
    finalized_data %>% filter(Tooth_site_number %in% upper_anterior) %>% nrow(), 
    finalized_data %>% filter(Tooth_site_number %in% lower_posterior) %>% nrow(), 
    finalized_data %>% filter(Tooth_site_number %in% lower_anterior) %>% nrow())

tooth_site_groups=data.frame(groups=c("upper_posterior", "upper_anterior", "lower_posterior", "lower_anterior"), n=n) %>% mutate(prop=round(n/sum(n),4))

tooth_site_groups%>%
datatable(extensions = 'Buttons',
          caption = "tooth site groups",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


parameters=character()
pvalue=numeric()
kk=0
  for (i in 1:(nrow(tooth_site_groups)-1))
  for (j in (i+1):nrow(tooth_site_groups))
  {
    kk=kk+1
    parameters[kk]=paste(tooth_site_groups[i,1], tooth_site_groups[j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(tooth_site_groups[i,2], tooth_site_groups[j,2]), p = 0.5)$p.value)
  }


data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = "tooth site groups",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```




### 1.4 Variables with CBCT1 and CBCT2 versions


```{r, message=F, warning=F}
#"Height_coronal",
#"Height_sagittal",


variables=c("ANS_PNS_crest_coronal", 
"ANS_PNS_crest_sagittal",
"mental_crest_coronal",
"mental_crest_sagittal",
"ANS_PNS_sinus_floor_coronal",
"ANS_PNS_sinus_floor_sagittal", 
"width_3mm", 
"width_5mm",
"mesial_tooth_bone_loss",
"distal_tooth_bone_loss", "Height_coronal", "Height_sagittal")


CBCT1=data.frame(finalized_data$ANPNS_Crest_Coronal_CBCT1, 
        finalized_data$ANSPNS_Crest_Sagittal_CBCT1, 
        finalized_data$MENTAL_Crest_Sagittal_CBCT1, 
        finalized_data$MENTAL_Crest_Coronal_CBCT1, 
        finalized_data$ANSPNS_Sinus_Floor_Coronal_CBCT1, 
        finalized_data$ANSPNS_Sinus_Floor_Sagittal_CBCT1, 
        finalized_data$Width_3mm_CBCT1, 
        finalized_data$Width_5mm_CBCT1, 
        finalized_data$mesial_tooth_bone_loss_CBCT.1__mm, 
        finalized_data$distal_tooth_bone_loss_CBCT.1__mm, 
        finalized_data$Height_coronal_CBCT1, 
        finalized_data$Height_sagittal_CBCT1
        )


CBCT2=data.frame(finalized_data$ANSPNS_Crest_Coronal_CBCT2, 
        finalized_data$ANSPNS_Crest_Sagittal_CBCT2, 
        finalized_data$MENTAL_Crest_Sagittal_CBCT2, 
        finalized_data$MENTAL_Crest_Coronal_CBCT2, 
        finalized_data$ANSPNS_Sinus_Floor_Coronal_CBCT2, 
        finalized_data$ANSPNS_Sinus_Floor_Sagittal_CBCT2, 
        finalized_data$Width_3mm_CBCT2, 
        finalized_data$Width_5mm_CBCT2, 
        finalized_data$mesial_tooth_bone_loss_CBCT.2__mm, 
        finalized_data$distal_tooth_bone_loss_CBCT.2__mm, 
        finalized_data$Height_coronal_CBCT2, 
        finalized_data$Height_sagittal_CBCT2)

colnames(CBCT1)=colnames(CBCT2)=variables


pvalue <- sapply(1:ncol(CBCT1), function(i) t.test(CBCT1[,i], CBCT2[,i], paired = TRUE)$p.value)

data.frame(variables=variables, pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "CBCT 1 vs CBCT 2",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* paired two sample t test was used.  



## 2. group 2 vs 3


```{r, message=F, warning=F}
group2_maxilla=finalized_data %>% filter(Jaw==1)
group3_mandible=finalized_data %>% filter(Jaw==2)
```






### 2.1 continuous variables 





```{r, message=F, warning=F}

data_conti=as.matrix(group2_maxilla[,which(colnames(group2_maxilla)%in%continuous_var)])

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = " group 2",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```

* correlation of group 2 




```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="pearson", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```





```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="spearman", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```








```{r, message=F, warning=F}

data_conti=as.matrix(group3_mandible[,which(colnames(group3_mandible)%in%continuous_var)])

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = " group 3",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



* correlation of group 3 

```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="pearson", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```





```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="spearman", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



```{r, message=F, warning=F}
two_sample_test=function(var)
{
#  cat(var, "\n")
  sample1=as.numeric(group2_maxilla %>% select(var) %>% pull())
  sample2=as.numeric(group3_mandible %>% select(var) %>% pull())
  if (sum(!is.na(sample1))>0 & sum(!is.na(sample2))>0)
  { 
   wilcox_test <- wilcox.test(sample1, sample2)
   return(wilcox_test$p.value)
  }
  else
    return("NA")
  
}
pvalue=sapply(continuous_var, two_sample_test)
data.frame(variables=continuous_var, pvalue=pvalue_adjust(as.numeric(pvalue)))%>%
datatable(extensions = 'Buttons',
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```

* nonparametric  `wilcox.test` was used to test the difference 










### 2.2 discrete variables


```{r, message=F, warning=F, results='asis'}
# Create a tagList to collect all datatables
library(htmltools)
output_list1 <- tagList()
for (k in 1:length(discrete_var))
  
{

data_subset1=group2_maxilla %>% dplyr::count(across(discrete_var[k])) %>% mutate(prop=round(n/nrow(group2_maxilla),4)) %>% drop_na()

data_subset2=group3_mandible %>% dplyr::count(across(discrete_var[k])) %>% mutate(prop=round(n/nrow(group3_mandible),4)) %>% drop_na()

data_subset=rbind(data_subset1, data_subset2) %>% mutate(sample=c(rep("group2_maxilla", nrow(data_subset1)), rep("group3_mandible", nrow(data_subset2))))


# Append the datatable to the output list
  output_list1 <- tagAppendChild(
    output_list1,
    datatable(
      data_subset,
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
#############################
common_variable=intersect(data_subset %>% filter(sample=="group2_maxilla") %>% select(rlang::sym(discrete_var[k])) %>% pull(), data_subset %>% filter(sample=="group3_mandible") %>% select(rlang::sym(discrete_var[k])) %>% pull())
pvalue=numeric()
if (length(common_variable)>0)
{
for (i in 1:length(common_variable))
{
  variable_count=data_subset %>% filter(!!rlang::sym(discrete_var[k])==common_variable[i]) %>% select(n) %>% pull()
  pvalue[i]=pvalue_adjust(prop.test(x=variable_count, n=c(nrow(group2_maxilla), nrow(group3_mandible)))$p.value)
}
  
  
  ###########################
  # Append the datatable to the output list
  output_list1 <- tagAppendChild(
    output_list1,
    datatable(
      data.frame(variable=paste(common_variable, ":group2_maxilla_vs_group3_mandible"), pvalue=pvalue),
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )  
  
}
if (length(common_variable)==0)
  cat("no common variables between two groups", "\n")

  
}

# Render all datatables
output_list1

```


* two  sample proportion test was used. 








```{r, message=F, warning=F, results='asis'}
# Create a tagList to collect all datatables
library(htmltools)
output_list1 <- tagList()
discrete_var=c("Gender", "Smoking")

group2_maxilla_patient <- group2_maxilla %>%
  group_by(Patient) %>%
  filter(Gender != "") %>%  # Remove empty Gender rows
  slice(1) %>%  # Keep the first occurrence per Patient
  ungroup()


group3_mandible_patient <- group3_mandible %>%
  group_by(Patient) %>%
  filter(Gender != "") %>%  # Remove empty Gender rows
  slice(1) %>%  # Keep the first occurrence per Patient
  ungroup()

for (k in 1:length(discrete_var))
  
{

data_subset1=group2_maxilla_patient %>% dplyr::count(across(discrete_var[k])) %>% mutate(prop=round(n/nrow(group2_maxilla_patient),4)) %>% drop_na()

data_subset2=group3_mandible_patient %>% dplyr::count(across(discrete_var[k])) %>% mutate(prop=round(n/nrow(group3_mandible_patient),4)) %>% drop_na()

data_subset=rbind(data_subset1, data_subset2) %>% mutate(sample=c(rep("group2_maxilla", nrow(data_subset1)), rep("group3_mandible", nrow(data_subset2))))


# Append the datatable to the output list
  output_list1 <- tagAppendChild(
    output_list1,
    datatable(
      data_subset,
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
#############################
common_variable=intersect(data_subset %>% filter(sample=="group2_maxilla") %>% select(rlang::sym(discrete_var[k])) %>% pull(), data_subset %>% filter(sample=="group3_mandible") %>% select(rlang::sym(discrete_var[k])) %>% pull())
pvalue=numeric()
if (length(common_variable)>0)
{
for (i in 1:length(common_variable))
{
  variable_count=data_subset %>% filter(!!rlang::sym(discrete_var[k])==common_variable[i]) %>% select(n) %>% pull()
  pvalue[i]=pvalue_adjust(prop.test(x=variable_count, n=c(nrow(group2_maxilla), nrow(group3_mandible)))$p.value)
}
  
  
  ###########################
  # Append the datatable to the output list
  output_list1 <- tagAppendChild(
    output_list1,
    datatable(
      data.frame(variable=paste(common_variable, ":group2_maxilla_vs_group3_mandible"), pvalue=pvalue),
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )  
  
}
if (length(common_variable)==0)
  cat("no common variables between two groups", "\n")

  
}

# Render all datatables
output_list1

```



```{r, message=F, warning=F}
group2_maxilla_patient %>% select(Patient, Gender,Smoking) %>%
datatable(extensions = 'Buttons',
          caption = "group2_maxilla_patient", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


group3_mandible_patient %>% select(Patient, Gender,Smoking) %>%
datatable(extensions = 'Buttons',
          caption = "group3_mandible_patient", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```






### 2.3 Sinus_pathology (updated: subjects that have Jaw=maxilla)


```{r, message=F, warning=F}
group2_maxilla %>%
  dplyr::count(Sinus_Pathology) %>%
  mutate(Frequency = round( n / sum(n),4))

```



```{r, message=F, warning=F}

library(htmltools)
output_list <- tagList()
  res_df <- data.frame(sinus=c("1", "2", "3"), n=c(23, 3, 94)) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = "",
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0

if (nrow(res_df)>1)
  for (i in 1:(nrow(res_df)-1))
  for (j in (i+1):nrow(res_df))
  {
    kk=kk+1
    parameters[kk]=paste(res_df[i,1], res_df[j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res_df[i,2], res_df[j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)

output_list

```



### 2.4 tooth site groups


```{r, message=F, warning=F}
n1=c(group2_maxilla %>% filter(Tooth_site_number %in% upper_posterior) %>% nrow(), 
    group2_maxilla %>% filter(Tooth_site_number %in% upper_anterior) %>% nrow(), 
    group2_maxilla %>% filter(Tooth_site_number %in% lower_posterior) %>% nrow(), 
    group2_maxilla %>% filter(Tooth_site_number %in% lower_anterior) %>% nrow())

n2=c(group3_mandible %>% filter(Tooth_site_number %in% upper_posterior) %>% nrow(), 
    group3_mandible %>% filter(Tooth_site_number %in% upper_anterior) %>% nrow(), 
    group3_mandible %>% filter(Tooth_site_number %in% lower_posterior) %>% nrow(), 
    group3_mandible %>% filter(Tooth_site_number %in% lower_anterior) %>% nrow())



tooth_site_groups=data.frame(tooth_site=rep(c("upper_posterior", "upper_anterior", "lower_posterior", "lower_anterior"),2), n=c(n1, n2), groups=rep(c("group2_maxilla","group3_mandible"), each=4 ))  %>% mutate(prop=c(round(n1/sum(n1),4), round(n2/sum(n2),4)))

tooth_site_groups%>%
datatable(extensions = 'Buttons',
          caption = "tooth site groups",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))



```



## 3. group 4 


```{r, message=F, warning=F}
group4_data=finalized_data %>% filter(Patient %in% c(25, 26, 44, 58, 78, 81))

group4_data=group4_data %>% filter(!Subject %in% c(228, 229, 230, 231, 251)) # remove these 5 subjects

group4_data%>%
datatable(extensions = 'Buttons',
          caption = "group 4",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


### 3.1 continuous variables



```{r, message=F, warning=F}

data_conti=as.matrix(group4_data[,which(colnames(group4_data)%in%continuous_var)])

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>2)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="pearson", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=2)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```





```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>2)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="spearman", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=2)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of spearman correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "Spearman correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```




### 3.2 discrete variables 


```{r, message=F, warning=F}
discrete_var=c("Tooth_site_number", 
               "Tooth_migration", 
               "M_Tooth_Migration",  
               "D_Tooth_Migration",  
               "Migration_Notes", 
               "mesial_tooth_bone_loss_CBCT.1__mm", 
               "Jaw",                        
                "Arch_Fully_edentulous_both_CBCTs",
                "Partially_edentulous",
               "Partial_Edentulous_Space_.Length",
                "Adjacent_teeth_number",
               "Adjacent_Note",                      
                "Restoration_type",
               "Restoration_Notes",                  
                "Ext_Reason",                                   
                "Coronal_sinus_floor_shift",  
                "Sinus_Pathology",
                 "Sites_10mm_height_or_more",          
                 "X1st_CBCT_10mm_or_more",
               "X2nd_CBCT_10mm_or_more" )
data_discrete=group4_data[,which(colnames(group4_data)%in%discrete_var)]

res=apply(data_discrete, 2, discrete_summary)
```





```{r, message=F, warning=F, results='asis'}
# Create a tagList to collect all datatables
library(htmltools)
output_list <- tagList()
for (k in 1:length(res))
  
{

  res_df <- data.frame(res[[k]]) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = discrete_var[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0

if (nrow(res[[k]])>1)
  for (i in 1:(nrow(res[[k]])-1))
  for (j in (i+1):nrow(res[[k]]))
  {
    kk=kk+1
    parameters[kk]=paste(res[[k]][i,1], res[[k]][j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res[[k]][i,2], res[[k]][j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)


  
  
  
}

# Render all datatables
output_list
```







```{r, message=F, warning=F}

discrete_var=c("Gender", "Smoking" )
data_discrete=group4_data[,which(colnames(group4_data)%in%discrete_var)]

res=apply(data_discrete, 2, discrete_summary)



# Create a tagList to collect all datatables
library(htmltools)
output_list <- tagList()
for (k in 1:length(res))
  
{

  res_df <- data.frame(res[[k]]) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = names(res)[k],
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0
  for (i in 1:(nrow(res[[k]])-1))
  for (j in (i+1):nrow(res[[k]]))
  {
    kk=kk+1
    parameters[kk]=paste(res[[k]][i,1], res[[k]][j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res[[k]][i,2], res[[k]][j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = names(res)[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)


  
  
  
}

# Render all datatables
output_list

```





### 3.3 tooth site groups 

```{r, message=F, warning=F}
n=c(group4_data %>% filter(Tooth_site_number %in% upper_posterior) %>% nrow(), 
    group4_data %>% filter(Tooth_site_number %in% upper_anterior) %>% nrow(), 
    group4_data %>% filter(Tooth_site_number %in% lower_posterior) %>% nrow(), 
    group4_data %>% filter(Tooth_site_number %in% lower_anterior) %>% nrow())

tooth_site_groups=data.frame(groups=c("upper_posterior", "upper_anterior", "lower_posterior", "lower_anterior"), n=n) %>% mutate(prop=round(n/sum(n),4))

tooth_site_groups%>%
datatable(extensions = 'Buttons',
          caption = "tooth site groups",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


parameters=character()
pvalue=numeric()
kk=0
  for (i in 1:(nrow(tooth_site_groups)-1))
  for (j in (i+1):nrow(tooth_site_groups))
  {
    kk=kk+1
    parameters[kk]=paste(tooth_site_groups[i,1], tooth_site_groups[j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(tooth_site_groups[i,2], tooth_site_groups[j,2]), p = 0.5)$p.value)
  }


data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = "tooth site groups",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```



### 3.4 Variables with CBCT1 and CBCT2 versions


```{r, message=F, warning=F}
#"Height_coronal",
#"Height_sagittal",


variables=c("ANS_PNS_crest_coronal", 
"ANS_PNS_crest_sagittal",
"mental_crest_coronal",
"mental_crest_sagittal",
"ANS_PNS_sinus_floor_coronal",
"ANS_PNS_sinus_floor_sagittal", 
"width_3mm", 
"width_5mm",
"mesial_tooth_bone_loss",
"distal_tooth_bone_loss", 
"Height_coronal", 
"Height_sagittal")


CBCT1=data.frame(group4_data$ANPNS_Crest_Coronal_CBCT1, 
        group4_data$ANSPNS_Crest_Sagittal_CBCT1, 
        group4_data$MENTAL_Crest_Sagittal_CBCT1, 
        group4_data$MENTAL_Crest_Coronal_CBCT1, 
        group4_data$ANSPNS_Sinus_Floor_Coronal_CBCT1, 
        group4_data$ANSPNS_Sinus_Floor_Sagittal_CBCT1, 
        group4_data$Width_3mm_CBCT1, 
        group4_data$Width_5mm_CBCT1, 
        group4_data$mesial_tooth_bone_loss_CBCT.1__mm, 
        group4_data$distal_tooth_bone_loss_CBCT.1__mm, 
        group4_data$Height_coronal_CBCT1, 
        group4_data$Height_sagittal_CBCT1)


CBCT2=data.frame(group4_data$ANSPNS_Crest_Coronal_CBCT2, 
        group4_data$ANSPNS_Crest_Sagittal_CBCT2, 
        group4_data$MENTAL_Crest_Sagittal_CBCT2, 
        group4_data$MENTAL_Crest_Coronal_CBCT2, 
        group4_data$ANSPNS_Sinus_Floor_Coronal_CBCT2, 
        group4_data$ANSPNS_Sinus_Floor_Sagittal_CBCT2, 
        group4_data$Width_3mm_CBCT2, 
        group4_data$Width_5mm_CBCT2, 
        group4_data$mesial_tooth_bone_loss_CBCT.2__mm, 
        group4_data$distal_tooth_bone_loss_CBCT.2__mm, 
        group4_data$Height_coronal_CBCT2, 
        group4_data$Height_sagittal_CBCT2)

colnames(CBCT1)=colnames(CBCT2)=variables
CBCT1 <- CBCT1 %>% select(where(~ !all(is.na(.))))
CBCT2 <- CBCT2 %>% select(where(~ !all(is.na(.))))

pvalue <- sapply(1:ncol(CBCT1), function(i) t.test(CBCT1[,i], CBCT2[,i], paired = TRUE)$p.value)

data.frame(variables=colnames(CBCT1), pvalue=pvalue_adjust(pvalue))%>%
datatable(extensions = 'Buttons',
          caption = "CBCT 1 vs CBCT 2",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


* variables full of NA need to be dropped 




###  3.5 descriptive statistics for maxilla and mandible in group 4


```{r, message=F, warning=F}

group4_maxilla=group4_data %>% filter(Jaw==1)
group4_mandible=group4_data %>% filter(Jaw==2)


data_conti=as.matrix(group4_maxilla[,which(colnames(group4_maxilla)%in%continuous_var)])

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = " maxilla in group 4",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


data_conti=as.matrix(group4_mandible[,which(colnames(group4_mandible)%in%continuous_var)])

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = " mandible in group 4",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))



```


### 3.6 continuous variable comparisons between maxilla and mandible

```{r, message=F, warning=F}

group4_maxilla_conti=as.matrix(group4_maxilla[,which(colnames(group4_maxilla)%in%continuous_var)])
group4_mandible_conti=as.matrix(group4_mandible[,which(colnames(group4_mandible)%in%continuous_var)])

pvalue=numeric()
pvalue <- sapply(1:ncol(group4_mandible_conti), function(i) {
  x <- group4_mandible_conti[, i]
  y <- group4_maxilla_conti[, i]
  if (sum(!is.na(x)) > 0 && sum(!is.na(y)) > 0) {
    t.test(x, y)$p.value
  } else {
    NA
  }
})

data.frame(variables=colnames(group4_mandible_conti), pvalue=pvalue_adjust(pvalue)) %>%
datatable(extensions = 'Buttons',
          caption = " ",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
 

```

* two test t test was used. 


### 3.7 discrete variable comparisons between maxilla and mandible

```{r, message=F, warning=F}

discrete_var=c("Tooth_site_number", 
               "Tooth_migration", 
               "M_Tooth_Migration",  
               "D_Tooth_Migration",  
               "Migration_Notes", 
               "mesial_tooth_bone_loss_CBCT.1__mm", 
               "Jaw",                        
                "Arch_Fully_edentulous_both_CBCTs",
                "Partially_edentulous",
               "Partial_Edentulous_Space_.Length",
                "Adjacent_teeth_number",
               "Adjacent_Note",                      
                "Restoration_type",
               "Restoration_Notes",                  
                "Ext_Reason",                                   
                "Coronal_sinus_floor_shift",  
                "Sinus_Pathology",
                 "Sites_10mm_height_or_more",          
                 "X1st_CBCT_10mm_or_more",
               "X2nd_CBCT_10mm_or_more" )

group4_maxilla_discrete=as.matrix(group4_maxilla[,which(colnames(group4_maxilla)%in%discrete_var)])
group4_mandible_discrete=as.matrix(group4_mandible[,which(colnames(group4_mandible)%in%discrete_var)])

# Prepare result list
results <- list()

# Loop through each column
for (col in colnames(group4_maxilla_discrete)) {
  x <- group4_maxilla_discrete[, col]
  y <- group4_mandible_discrete[, col]
  
  # Get unique non-NA values from both datasets
  levels <- unique(na.omit(c(x, y)))
  
  # For each outcome value in the column
  for (level in levels) {
    x_count <- sum(x == level, na.rm = TRUE)
    y_count <- sum(y == level, na.rm = TRUE)
    x_total <- sum(!is.na(x))
    y_total <- sum(!is.na(y))
    
    # 2x2 table: rows = groups, columns = outcome (yes/no)
    mat <- matrix(c(x_count, x_total - x_count,
                    y_count, y_total - y_count), 
                  nrow = 2, byrow = TRUE)
    
    # Run test
    test <- if (any(mat < 5)) fisher.test(mat) else prop.test(mat)
    
    # Save results
    results[[paste(col, level, sep = "_")]] <- list(
      column = col,
      level = level,
      p.value = pvalue_adjust(test$p.value),
      prop_maxilla = x_count / x_total,
      prop_mandible = y_count / y_total
    )
  }
}

# Convert results to a data frame
results_df <- do.call(rbind, lapply(results, as.data.frame))
rownames(results_df) <- names(results)
 
results_df%>%
datatable(extensions = 'Buttons',
          caption = " ",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```








## 4. tooth migration 


```{r, message=F, warning=F}
cat("pvalue of 22 Y vs 152 N is:", pvalue_adjust(binom.test(c(22, (22+152)), p = 0.5)$p.value), "\n")

```


## 5. Sinus_pathology 

```{r, message=F, warning=F}

library(htmltools)
output_list <- tagList()
  res_df <- data.frame(ans=c("1", "2", "3"), n=c(23, 3, 61)) # Convert the current list element to a data frame
# Append the datatable to the output list
  output_list <- tagAppendChild(
    output_list,
    datatable(
      res_df,
      extensions = 'Buttons',
      caption = "",
      options = list(
        dom = 'Blfrtip',
        buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
        lengthMenu = list(c(10, 25, 50, -1), c(10, 25, 50, "All"))
      )
    )
  )
  
  ############# calculate p values 
parameters=character()
pvalue=numeric()
kk=0

if (nrow(res_df)>1)
  for (i in 1:(nrow(res_df)-1))
  for (j in (i+1):nrow(res_df))
  {
    kk=kk+1
    parameters[kk]=paste(res_df[i,1], res_df[j,1], sep="_vs_")
    pvalue[kk]=pvalue_adjust(binom.test(c(res_df[i,2], res_df[j,2]), p = 0.5)$p.value)
  }
output_list <- tagAppendChild(
    output_list,
data.frame(comparison=parameters, pvalue=pvalue) %>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
)

output_list

```






## 6. New p-values


1. ANS_PNS_crest_coronal_DIFF VERSUS mental_crest_coronal_DIFF


```{r, message=F, warning=F}
pvalue_adjust(t.test(finalized_data$ANSPNS_Crest_Coronal_DIFF, finalized_data$MENTAL_Crest_Coronal_DIFF)$p.value)
```
* there are statistically significantly different 



2. ANS_PNS_crest_sagittal_DIFF VERSUS mental_crest_sagittal_DIFF

```{r, message=F, warning=F}
pvalue_adjust(t.test(finalized_data$ANSPNS_Crest_Sagittal_DIFF, finalized_data$MENTAL_Crest_Sagittal_DIFF)$p.value)
```


* they are different 


## 7.  additional p values 


Sites were distributed between maxilla and mandible (n=120 vs. n=133, p=0.4507) and anterior (n=33 vs. n=17, p=0.0328) and posterior sites (n=116 vs. n=116, p=1.0000) in maxillary and mandibular sites, respectively.


```{r, message=F, warning=F}
binom.test(120, 120+133)$p.value
binom.test(33, 33+17)$p.value
binom.test(87, 87+116)$p.value
```



## 8. months_between_CBCTs between 12-24 months


* [months_between_CBCTs between 12-24 months](2024_1002_Neal_additional_part1.html)




## 9. group 5

[here is group 5](2024_1002_Neal_group5.html)



## 10. group 6 

[here is group 6](2024_1002_Neal_group6.html)



## 11 "6 final data file" - Under finalized data tab


### 11.1 [run the analysis that is already is the website with the updated subjects and numbers;  Spearman's correlations for group 4 separately for maxilla and mandible and for group 5 separately for maxilla and mandible](2024_1002_Neal_11_1.html)

## 12  "6 final data file"- Under M-D Tooth Migration tab
 
 
### 12.1 [calculate frequency of M_tooth_migration and D_tooth_migration. Is there a difference in distribution of these variables?](2024_1002_Neal_12_1.html)


## 13. "6 final data file" - Under Coronal Movement tab


[calculate frequency of coronal_movement_both_teeth, M_tooth_coronal_migration, D_tooth_coronal_migration. Is there a difference in distribution bewteen M_tooth_coronal_migration, D_tooth_coronal_migration?](2024_1002_Neal_13_1.html)


## 14. "TNP calibration file"


[Cohen's kappa for the pairs of variables ](2024_1002_Neal_14_1.html)



## statistical tests 

1. for continuous variables, two sample (paired or unpaired) test was used.  

2. for categorical variables, binomial test was used. 

