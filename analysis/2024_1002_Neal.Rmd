---
title: "2024/10/07"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
date: "2024-10-07"
---



```{r, echo=F, message=F, warning=F}
source("C:/Shengtong/Research/AllCollaboration/Collaborations/analysis/Rfunctions.R")
```


```{r, message=F, warning=F, results=F}
#data_raw=multiplesheets("C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\CBCT Thesis data FINAL VK111324.xlsx")
#finalized_data=data_raw$`Finalized Data`
#finalized_with_omitted_data=data_raw$`Finalized with Omitted data`
#coding=data_raw$`Coding`
#save(finalized_with_omitted_data, finalized_data, coding, file="C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\data.RData")
load("C:\\Shengtong\\Research\\AllCollaboration\\2024\\202410\\Neal\\data.RData")
col_names=as.character(finalized_data[1,])
finalized_data=finalized_data[-1,]
colnames(finalized_data)=col_names
```


## Finalized data 


```{r, message=F, warning=F}
colnames(finalized_data)
```




### continuous variables 

```{r, message=F, warning=F, eval=T}
continuous_var=c("Age", 
"Months_btwn_CBCTS",  
"Months_btwn_Ext_CBCT#1",
"mesial_tooth_bone_loss_CBCT#2__mm",   
"mesial_tooth_bone_loss_DIFF",         
"distal_tooth_bone_loss_CBCT#1__mm",    
"distal_tooth_bone_loss_CBCT#2__mm",   
"distal_tooth_bone_loss_DIFF",    
"ANPNS_Crest_Coronal_CBCT1",
"ANSPNS_Crest_Coronal_CBCT2",          
"ANSPNS_Crest_Coronal_DIFF",           
"ANSPNS_Crest_Sagittal_CBCT1",        
"ANSPNS_Crest_Sagittal_CBCT2",         
"ANSPNS_Crest_Sagittal_DIFF",          
"ANSPNS_Sinus_Floor_Coronal_CBCT1",   
"ANSPNS_Sinus_Floor_Coronal_CBCT2",    
"ANSPNS_Sinus_Floor_Coronal_DIFF",     
"ANSPNS_Sinus_Floor_Sagittal_CBCT1",   
"ANSPNS_Sinus_Floor_Sagittal_CBCT2",   
"ANSPNS_Sinus_Floor_Sagittal_DIFF",    
"MENTAL_Crest_Coronal_CBCT1",         
"MENTAL_Crest_Coronal_CBCT2",         
 "MENTAL_Crest_Coronal_DIFF",           
"MENTAL_Crest_Sagittal_CBCT1",         
"MENTAL_Crest_Sagittal_CBCT2",         
"MENTAL_Crest_Sagittal_DIFF",
"Width_3mm_CBCT1",                     
"Width_3mm_CBCT2",                     
"Width_3mm_DIFF",                      
"Width_5mm_CBCT1",                     
"Width_5mm_CBCT2",                     
"Width_5mm_DIFF")
data_conti=finalized_data[,which(colnames(finalized_data)%in%continuous_var)]

res=summary_statistics(data_conti)
data.frame(res) %>%
datatable(extensions = 'Buttons',
          caption = "",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


```{r, message=F, warning=F}
################ compute p values 
#data_conti[is.na(data_conti)] <- "0"
#cormat2=round(cor(data_conti, method="pearson", use = "na.or.complete"),2)
cormat2=matrix(nrow=ncol(data_conti), ncol=ncol(data_conti))
cormat2_pvalue=matrix(nrow=nrow(cormat2), ncol=nrow(cormat2))
for (i in 1:nrow(cormat2))
  for (j in 1:nrow(cormat2))
    {
    combine_data=data.frame(x=as.numeric(data_conti[,i]), y=as.numeric(data_conti[,j])) %>% drop_na()
    if (nrow(combine_data)>1)
    {
    test=cor.test(combine_data[,1], combine_data[,2], method="pearson", use = "na.or.complete")
    cormat2[i,j]=round(test$estimate,4)
    cormat2_pvalue[i,j]=round(test$p.value,4)
    }
    if (nrow(combine_data)<=1)  # no enough data to calculate correlations 
    {
     cormat2[i,j]="NA"
     cormat2_pvalue[i,j]="NA" 
      
    }
    
  }
row.names(cormat2)=colnames(data_conti) 
colnames(cormat2)=colnames(data_conti) 
cormat2 %>%
datatable(extensions = 'Buttons',
          caption = "Pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


row.names(cormat2_pvalue)=colnames(data_conti) 
colnames(cormat2_pvalue)=colnames(data_conti) 
cormat2_pvalue %>%
datatable(extensions = 'Buttons',
          caption = "P values of pearson correlation",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))


correlation_pvalue=matrix(paste(cormat2, "(", cormat2_pvalue, ")", sep=""), nrow=nrow(cormat2))
rownames(correlation_pvalue)=row.names(cormat2)
colnames(correlation_pvalue)=row.names(cormat2)
correlation_pvalue%>%
datatable(extensions = 'Buttons',
          caption = "correlation (p value)",
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```





### discrete variables 


```{r, message=F, warning=F}
discrete_var=c("Tooth_site_number", 
               "Gender", 
               "Smoking", 
               "Tooth_migration", 
               "M_Tooth_Migration",  
               "D_Tooth_Migration",  
               "Migration_Notes", 
               "mesial_tooth_bone_loss_CBCT#1__mm", 
               "Jaw",                        
                "Arch_Fully_edentulous_both_CBCTs",
                "Partially_edentulous",
               "Partial_Edentulous_Space_\r\nLength",
                "Adjacent_teeth_number",
               "Adjacent_Note",                      
                "Restoration_type",
               "Restoration_Notes",                  
                "Ext_Reason",                                   
                "Coronal_sinus_floor_shift",  
                "Sinus_Pathology",
                 "Sites_10mm_height_or_more",          
                 "1st_CBCT_10mm_or_more",
               "2nd_CBCT_10mm_or_more" )
data_discrete=finalized_data[,which(colnames(finalized_data)%in%discrete_var)]

res=apply(data_discrete, 2, discrete_summary)
```



```{r, message=F, warning=F}
k=1
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=2
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=3
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=4
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=5
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=6
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=7
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=8
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=9
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=10
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=11
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=12
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=13
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=14
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=15
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=16
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=17
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=18
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=19
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=20
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=21
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

k=22
data.frame(res[[k]]) %>%
datatable(extensions = 'Buttons',
          caption = discrete_var[k],
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
```


```{r, message=F, warning=F}
group2_maxilla=finalized_data %>% filter(Jaw==1)
group3_mandible=finalized_data %>% filter(Jaw==2)
```


