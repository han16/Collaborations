---
title: "3/11/2022"
output: html_document
---

```{r setup, include=FALSE}
rm(list=ls())
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(kableExtra)
library(ggpubr)
library(rstatix) # use anova_test function 
library(DT)
set.seed(123)
```


```{r, echo=F, warning=F, message=F}
pvalue_adjust=function(p_value)
{
  p_value_adjust=numeric()
for (i in 1:length(p_value))
{
  if (is.na(p_value[i])==T)
    p_value_adjust[i]=p_value[i]
  if (is.na(p_value[i])==F & p_value[i]<0.0001)
    p_value_adjust[i]="<0.0001"
  if (is.na(p_value[i])==F & p_value[i]>0.0001)
    p_value_adjust[i]=round(p_value[i],4)
}
  return(p_value_adjust)
}
############### summary statistics for continuous variable 
summary_statistics=function(data)
{  # each column is one variable, and row one subject 
  
  variables=colnames(data)
num_sample=numeric()
Mean=numeric()
SD=numeric()
SE=numeric()
range_min=numeric()
range_max=numeric()
for (i in 1:ncol(data))
{
  observation=data[,i]
  observation=observation[!is.na(observation)]
  num_sample[i]=length(observation)
  Mean[i]=round(mean(observation),4)
  SD[i]=round(sd(observation),4)
  SE[i]=round(SD[i]/sqrt(num_sample[i]),4)
  range_min[i]=round(min(observation),4)
  range_max[i]=round(max(observation),4)
}

summary_data=data.frame(materials=variables, num_sample=num_sample, Mean=Mean, SD=SD, SE=SE, Range_low=range_min, Range_upper=range_max)

summary_data%>%
datatable(extensions = 'Buttons',
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
  
 return(summary_data) 
}
```



```{r, echo=F, message=F, warning=F}
data=as_tibble(read.csv("C:\\Shengtong\\Research\\AllCollaboration\\2022\\202203\\Marinho\\total.csv", header=T))
```

## Summary statistics 

```{r, echo=F, message=F, warning=F}
ggplot(data %>% count(Malocclusion) %>%mutate(prop=n/nrow(data)), aes(x=Malocclusion, y=n, fill=as.character(Malocclusion))) +geom_bar(stat="identity")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, size=10))+
  geom_text(aes(label=n), position=position_dodge(width=0.6), vjust=-0.25)+  # add numbers over bars
  ggtitle("")+
  theme(plot.title = element_text(hjust = 0.5, size=15))  #center the title 

ggplot(data %>% count(ID) %>%mutate(prop=n/nrow(data)), aes(x=ID, y=n, fill=as.character(ID))) +geom_bar(stat="identity")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, size=10))+
  geom_text(aes(label=n), position=position_dodge(width=0.6), vjust=-0.25)+  # add numbers over bars
  ggtitle("")+
  theme(plot.title = element_text(hjust = 0.5, size=15))  #center the title 

###########
g1=ggplot(data %>% count(SexNum) %>%mutate(prop=n/nrow(data)), aes(x=SexNum, y=n, fill=as.character(SexNum))) +geom_bar(stat="identity")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, size=10))+
  geom_text(aes(label=n), position=position_dodge(width=0.6), vjust=-0.25)+  # add numbers over bars
  ggtitle("")+
  theme(plot.title = element_text(hjust = 0.5, size=15))  #center the title 
g1
#########
g2=ggplot(data, aes(x=Age)) + 
  geom_histogram(color="blue", fill="blue")+
  geom_vline(aes(xintercept=mean(Age)),
            color="red", linetype="dashed", size=1)
g2


```

* in total there are 96 individuals 


## discretize the  age 

```{r, echo=T, message=F, warning=F}
age_group=as.character()
age_group[which(data$Age<=10)]="Phase_A"
age_group[which(data$Age>10 & data$Age<=13)]="Phase_B"
age_group[which(data$Age>13)]="Phase_C"
data_with_age_group=data%>%mutate(age_group=age_group)

ggplot(data_with_age_group %>% count(age_group) %>%mutate(prop=n/nrow(data_with_age_group)), aes(x=age_group, y=n, fill=as.character(age_group))) +geom_bar(stat="identity")+
  theme(legend.position="none")+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, size=10))+
  geom_text(aes(label=n), position=position_dodge(width=0.6), vjust=-0.25)+  # add numbers over bars
  ggtitle("")+
  theme(plot.title = element_text(hjust = 0.5, size=15))  #center the title 
```

* Phase_A: `data$Age<=10`

* Phase_B: `data$Age>10 & data$Age<=13`

* Phase_C: `data$Age>13`

```{r, echo=F, message=F, warning=F, cache=F}
unique_id=unique(data$ID)
mal_for_unique_id=numeric()
sex_for_unique_id=character()
num_variable=10
phase_a=matrix(nrow=length(unique_id), ncol=num_variable)
phase_b=matrix(nrow=length(unique_id), ncol=num_variable)
phase_c=matrix(nrow=length(unique_id), ncol=num_variable)
for (i in 1:length(unique_id))
{
  #cat(i, "is running", "\n")
  data_id=data_with_age_group %>% filter(ID==unique_id[i]) %>% select(L1.GoMe.mm, L6.GoMe.mm, U6.SN7.mm, U1.SN7.mm, Wits, Co.Go, N.Me, S.Go.N.Me...., ANS.Me.N.Me...., ANB, age_group)
  mal_for_unique_id[i]=unique(data_with_age_group %>% filter(ID==unique_id[i]) %>% select(Malocclusion) %>% pull())
  sex_for_unique_id[i]=unique(data_with_age_group %>% filter(ID==unique_id[i]) %>% select(Sex) %>% pull())
  #############
  data_id_a=data_id %>% filter(age_group=="Phase_A")
  if (nrow(data_id_a)>0)
    for (j in 1:num_variable)
      phase_a[i,j]=round(mean(data_id_a[,j] %>% pull),2) # use the mean for that specific phase 
   #############
  data_id_b=data_id %>% filter(age_group=="Phase_B")
  if (nrow(data_id_b)>0)
    for (j in 1:num_variable)
      phase_b[i,j]=round(mean(data_id_b[,j] %>% pull),2) # use the mean for that specific phase
  
   #############
  data_id_c=data_id %>% filter(age_group=="Phase_C")
  if (nrow(data_id_c)>0)
    for (j in 1:num_variable)
      phase_c[i,j]=round(mean(data_id_c[,j] %>% pull),2) # use the mean for that specific phase
  
}

data_phase=data.frame(ID=rep(unique_id, 3), Malocclusion=rep(mal_for_unique_id, 3), Sex=rep(sex_for_unique_id,3), L1.GoMe.mm=c(phase_a[,1], phase_b[,1], phase_c[,1]), L6.GoMe.mm=c(phase_a[,2], phase_b[,2], phase_c[,2]), U6.SN7.mm=c(phase_a[,3], phase_b[,3], phase_c[,3]), U1.SN7.mm=c(phase_a[,4], phase_b[,4], phase_c[,4]), Wits=c(phase_a[,5], phase_b[,5], phase_c[,5]), Co.Go=c(phase_a[,6], phase_b[,6], phase_c[,6]), N.Me=c(phase_a[,7], phase_b[,7], phase_c[,7]), S.Go.N.Me=c(phase_a[,8], phase_b[,8], phase_c[,8]), ANS.Me.N.Me=c(phase_a[,9], phase_b[,9], phase_c[,9]), ANB=c(phase_a[,10], phase_b[,10], phase_c[,10]), time=rep(c("Phase_A", "Phase_B", "Phase_C"), each=nrow(phase_a))) %>% drop_na()

common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )

data_phase%>%filter(ID %in% common_id==T)%>% 
datatable(extensions = 'Buttons',
          caption="", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* list all 57 individuals with observations in all 3 phases 



```{r, echo=F, message=F, warning=F}
mal=c("1", "2"); sex=c("M", "F")
num=numeric(); k=1

for (i in 1:length(mal))
  for (j in 1:length(sex))
     { 
      num[k]=length(unique(data_phase %>% filter(ID %in% common_id==T) %>% filter(Malocclusion==mal[i] & Sex==sex[j]) %>% select(ID) %>% pull))
      k=k+1
     }
data.frame(Malocclusion=rep(mal, each=2), Sex=rep(sex, 2), num=num)%>%
datatable(extensions = 'Buttons',
          caption="57 samples split by Malocclusion and Sex ", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### Sample variations 


```{r, echo=F, message=F, warning=F}
sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C")
variables=c("L1.GoMe.mm", "L6.GoMe.mm", "U6.SN7.mm", "U1.SN7.mm", "Wits", "Co.Go", "N.Me", "S.Go.N.Me", "ANS.Me.N.Me", "ANB")
ii=1
for (i in 1:length(phase))
  for (j in 1:length(variables))
  {
    all_sample=data_phase %>% filter(time==phase[i])
    sampled_data=sample(all_sample[,j+3], 60, replace=F) # sample 60, smallest number of individuals across 3 phases, without replacement
    sd[ii]=sd(sampled_data)
    ii=ii+1 
  }
phase_variations=data.frame(variables=rep(variables, 3), phase=rep(phase, each=length(variables)), sd=round(sd,1))
phase_variations%>%
datatable(extensions = 'Buttons',
          caption="variations", 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

ggplot(phase_variations, aes(x=variables, y=sd, fill=phase)) + 
  geom_bar(stat="identity", color="black", 
           position=position_dodge())+ 
  theme(legend.title=element_blank())+
  ylab("Standard deviations")+
  theme(axis.text.x = element_text(angle = 15, vjust = 0.5, size=10))+
 #theme(text = element_text(size=10))+
  geom_text(aes(label=round(sd,2)), position=position_dodge(width=0.8), vjust=-0.5, color="blue")
```

* 92 individuals are phase A, 90 at phase B and 60 at phase C. 
* randomly choose 60 individuals at each of 3 phases, to ensure same sample size for variations. 
* this result uses all 92 individuals, including 57 individuals having observations across 3 phases. 




### L1.GoMe.mm




#### repeated analysis 


```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="L1.GoMe.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

###################################  response profile analysis 
Patient.ID.Number=1:length(common_id)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between gender", col=c(2,4), trace.label = "") # trace.plot: legend title 


library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



* in total, 57 individuals have complete data across phase A, B, C 





```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="L1.GoMe.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

#######################

Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```
 
 
#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 






#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="L1.GoMe.mm"
k=1
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="L1.GoMe.mm"
k=1
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


### L6.GoMe.mm


#### repeated analysis 


```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="L6.GoMe.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#############################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)

```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="L6.GoMe.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
####################### response profile analysis 

Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 
```





#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 




#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="L6.GoMe.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="L6.GoMe.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### U6.SN7.mm


#### repeated analysis 



```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="U6.SN7.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```




```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="U6.SN7.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
######################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```





#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 





#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="U6.SN7.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="U6.SN7.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


### U1.SN7.mm


#### repeated analysis 

```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="U1.SN7.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="U1.SN7.mm"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 
```


#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 





#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="U1.SN7.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="U1.SN7.mm"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


### wits


#### repeated analysis 


```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="Wits"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="Wits"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)

```



#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 




#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="Wits"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="Wits"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


### Co.Go



#### repeated analysis 

```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="Co.Go"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="Co.Go"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 

```



#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 





#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="Co.Go"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="Co.Go"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### N.Me

#### repeated analysis 


```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 
```




#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 




#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### S.Go.N.Me

#### repeated analysis 


```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="S.Go.N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="S.Go.N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)

```


#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 






#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="S.Go.N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="S.Go.N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


### ANS.Me.N.Me

#### repeated analysis 

```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="ANS.Me.N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="ANS.Me.N.Me"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 
```



#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 





#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="ANS.Me.N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="ANS.Me.N.Me"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```



### ANB


#### repeated analysis 



```{r, echo=F, message=F, warning=F}
mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); gender=c("M", "F")
variable="ANB"
k=1
for (i in 1:length(phase))
  for (j in 1:length(gender))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Sex==gender[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(gender)), sex=rep(gender, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=sex, color=sex)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
#######################
common_id=intersect(intersect(data_phase%>% filter(time=="Phase_A") %>% select(ID) %>% pull, data_phase%>% filter(time=="Phase_B") %>% select(ID) %>% pull), data_phase%>% filter(time=="Phase_C") %>% select(ID) %>% pull )


Patient.ID.Number=1:length(common_id)

#trt=Patient.ID.Number
#trt[1:nrow(sub_data_juan)]="Juan"
#trt[(nrow(sub_data_juan)+1):length(trt)]="MM25"
#trt=factor(trt)

sex=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Sex) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Gender=sex, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Gender, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Gender*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
```



```{r, echo=F, message=F, warning=F}

mean=numeric(); sd=numeric()
phase=c("Phase_A", "Phase_B", "Phase_C"); Mal=c("1", "2")
variable="ANB"
k=1
for (i in 1:length(phase))
  for (j in 1:length(Mal))
  {
    mean[k]=round(mean(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T) %>% select(variable) %>% pull),4) 
    sd[k]=round(sd(data_phase %>% filter(time==phase[i] & Malocclusion==Mal[j] & ID %in% common_id==T ) %>% select(variable) %>% pull),4)
    k=k+1
  }
sub_data=data.frame(time=rep(phase, each=length(Mal)), Malocclusion=rep(Mal, length(phase)), mean=mean, sd=sd)

###################
ggplot(sub_data, aes(x=time, y=mean, group=Malocclusion, color=Malocclusion)) + 
  geom_line() +
  geom_point()+
  ylab(variable)+
  geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2,
                 position=position_dodge(.05)) 
###################
sub_data%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))
################################
Patient.ID.Number=1:length(common_id)

mal=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(Malocclusion) %>% pull

data_common_id=data.frame(id=Patient.ID.Number, Malocclusion=mal, y1=data_phase %>% filter(ID %in% common_id & time=="Phase_A") %>% select(variable) %>% pull,y2=data_phase %>% filter(ID %in% common_id & time=="Phase_B") %>% select(variable) %>% pull, y3=data_phase %>% filter(ID %in% common_id & time=="Phase_C") %>% select(variable) %>% pull)

######## convert into long format 
data_common_id_long <- reshape(data_common_id, idvar="id", varying=c("y1","y2","y3"), v.names="y", timevar="time", time=1:3, direction="long")
attach(data_common_id_long) # when attaching variables, DO not use same variable names multiple times 

######### plot mean curve 
#interaction.plot(time, Malocclusion, y, type="b", pch=c(19,21), xlab="Time", ylab=variable, main="Comparison between Malocclusion", col=c(2,4), trace.label = "") # trace.plot: legend title 



library(nlme)
model <- gls(y ~ Malocclusion*time, corr=corSymm(, form= ~ time | id), weights = varIdent(form = ~ 1 | time))
#summary(model)

 anova(model)
 
```



#### repeated anova  within Mal groups

 
```{r, echo=F, message=F, warning=F}
################### repeated anova 
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==1), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 res.aov <- anova_test(data = data_common_id_long %>% filter(Malocclusion==2), dv = y, wid = id, within = time)
get_anova_table(res.aov)
 
```

#### paired two sample t tests 


```{r, echo=F, message=F, warning=F}
pvalue=numeric()

  mal_group1=data_common_id %>% filter(Malocclusion==1)%>% select(y1, y2, y3)
  pvalue[1]=t.test(mal_group1[,1], mal_group1[,2], paired=T)$p.value
  pvalue[2]=t.test(mal_group1[,2], mal_group1[,3], paired=T)$p.value
  
  mal_group2=data_common_id %>% filter(Malocclusion==2)%>% select(y1, y2, y3)
  pvalue[3]=t.test(mal_group2[,1], mal_group2[,2], paired=T)$p.value
  pvalue[4]=t.test(mal_group2[,2], mal_group2[,3], paired=T)$p.value
data.frame(Malocclusion=c("1", "2"), phaseA_vs_phaseB=pvalue_adjust(pvalue[c(1,3)]), phaseB_vs_phaseC=pvalue_adjust(pvalue[c(2,4)]))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

  
```

* two sample paired t test was used. 





#### individual phase analysis 

```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="ANB"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Sex=="M" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Sex=="F" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, M_vs_F=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```

* two sample t test was used 




```{r, echo=F, message=F, warning=F}
phase=c("Phase_A", "Phase_B", "Phase_C")
p_value=numeric(); estimate=numeric(); CI_lower=numeric(); CI_upper=numeric()
variable="ANB"
for (i in 1:length(phase))
  {
    sample1=data_phase %>% filter(time==phase[i] & Malocclusion=="1" & ID %in% common_id==T) %>% select(variable) %>% pull
    sample2=data_phase %>% filter(time==phase[i] & Malocclusion=="2" & ID %in% 
common_id==T ) %>% select(variable) %>% pull
    test=t.test(sample1, sample2)
    p_value[i]=test$p.value
    estimate[i]=test$estimate[1]-test$estimate[2]
    CI_lower[i]=test$conf.int[1]
    CI_upper[i]=test$conf.int[2]
}
data.frame(phase=phase, Malocclusion1_vs_Malocclusion2=round(estimate,4), CI_lowe=round(CI_lower,4), CI_upper=round(CI_upper,4), p_value=pvalue_adjust(p_value))%>%
datatable(extensions = 'Buttons',
          caption=variable, 
            options = list(dom = 'Blfrtip',
                           buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                           lengthMenu = list(c(10,25,50,-1),
                                             c(10,25,50,"All"))))

```


## statistical software 

```{r, echo=F}
R.version
```


